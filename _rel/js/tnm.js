 /*! tnm 2016-04-26 */
!function(){IX.ns("TCM.Const"),TCM.Const.SiteTypes={TCC:0,OCC:1,Depot:2,Station:3,BOCC:4,LinePolice:5,PTSD:6},TCM.Const.SiteTypeNames=["指挥中心","控制中心","车辆段／停车场","车站","备用控制中心","公安派出所","公交总队"],TCM.Const.UserTypes={Super:0,Admin:1,User:2},TCM.Const.UserTypeNames=["超级用户","管理员","普通用户"],TCM.Const.DeviceTypes={TNM:0,TVS:1,TAS:2,TVR:3,Storage:10,IPCFixed:20,IPCSemiSphere:21,IPCSphere:22,CameraFixed:31,CameraSemiSphere:32,CameraSphere:33,RedirectPickup:40,OmnidirectPickup:41,Coder:50,Decoder:51,Spliter:52,Monitor:53,Terminal:54,SpecialDecoder:55,HUB:60,PDH:61,FiberConvertor:62,KVM:63,PDU:64,VDM:65,Other:90},TCM.Const.DeviceTypeNames={0:"网管服务器",1:"视频服务器",2:"视频分析服务器",3:"存储服务器",4:"配置管理服务器",10:"存储设备",20:"固定枪机",21:"半球机",22:"球机",31:"固定枪机",32:"半球机",33:"球机",40:"定向拾音器",41:"全向拾音器",50:"编码器",51:"解码器",52:"画面分割器",53:"监视器",54:"控制终端",55:"解码器",60:"交换机",61:"光端机",62:"光纤收发器",63:"数字KVM",64:"数字PDU",65:"字符叠加器",90:"其他设备"},TCM.Const.Days="周日,周一,周二,周三,周四,周五,周六".split(",")}(),function(){IX.ns("TNM.Const"),TNM.Const.MaxUnitInRack=42,TNM.Const.PXPerUnit=17,TNM.Const.FaultLevels={0:"正常",1:"一般",2:"严重"},TNM.Const.FaultCodes={UNKNOWN:-1,DISK_ERROR:0,DISK_WRITE_FAILED:1,DISK_FULL:2,BROKEN:3,BROKEN_RESUME:4,VIDEO_LOST:100,VIDEO_HIDE:101,INPUT:102,ANALYSIS:103},TNM.Const.FaultFormats={"-1":"发生异常报警",101:"系统初始化",103:"用户登入",105:"用户注销",107:"监视器切换",109:"云台控制",111:"打开视频文件",113:"关闭视频文件",115:"报警设备报告信息",117:"智能报警事件",119:"OSD信息变化",201:"CPU使用率过高",203:"内存使用率过高",205:"磁盘阵列不能写",207:"磁盘阵列不能读写",209:"磁盘阵列没有做RAID",211:"通道损坏",213:"端口电压异常",215:"端口电流异常",217:"磁盘满",219:"存储文件的完整性检测报警",221:"授权文件错误",223:"授权文件恢复",225:"电源关闭或异常",227:"电源恢复",229:"数据口网络异常",231:"数据口网络恢复",233:"磁盘被拔出或异常",235:"磁盘插入",32768:"录像数据恢复、视频正常",32769:"录像数据丢失",32770:"运动感知停止",32771:"运动感知发生",32772:"视频遮挡停止、视频正常",32773:"视频遮挡发生",32774:"视频断线停止",32775:"视频断线发生",32788:"报警停止",32789:"报警发生",32790:"连接断开",32791:"建立连接",32792:"解锁摄像机",32793:"锁定摄像机",32794:"解锁监视器",32795:"锁定监视器",32796:"停止数字码流传输",32797:"发起数字码流传输",32798:"停止手动录像",32799:"发起手动录像",32800:"断线后恢复",32801:"发生断线",32802:"ROFS报告的错误恢复",32803:"ROFS报告的错误"},TNM.Const.LogType={"-1":"未知日志",0:"用户登录",1:"用户登出",2:"查看实时流",3:"停止查看实时流",4:"云台控制",5:"云台锁定",6:"云台解锁",7:"开始服务器手动录像",8:"停止服务器手动录像",9:"录像查询",10:"开始录像回放",11:"停止录像回放",12:"开始录像下载",13:"停止录像下载",14:"事件订阅",15:"关闭事件订阅",16:"设置画面分割器",17:"设置解码器数据源",18:"添加电视墙轮询计划",19:"修改电视墙轮询计划",20:"删除电视墙轮询计划",21:"启动临时授权",22:"停止临时授权",30:"监视器分屏设置",31:"监视器设置摄像机",32:"监视器锁定",33:"监视器解锁",34:"监视器轮询控制",35:"电视墙事件订阅",36:"关闭电视墙事件订阅",400:"CPU利用率过高",401:"内存利用率过高",402:"网络带宽不足",1e3:"TNM 登录",1001:"TNM 登出",1002:"添加机柜",1003:"编辑机柜",1004:"删除机柜",1005:"添加机柜设备",1006:"移动机柜设备",1007:"删除机柜设备",1008:"修改登录方式",1009:"处理故障"},TNM.Const.LogFormats={}}(),function(){function a(a,b){function c(a,b){return null===a||null===b||a.id==b.id}function d(a,b){b in j||(j[b]={});var c=j[b],d=a[b];d in c||(c[d]=[]),c[d].push(a.id)}function e(a,c){h[a.id]=c,i[a.name]=c,IX.iterate(b,function(b){d(a,b)})}function f(){g=IX.Array.toSet(g,c),h={},i={},j={},IX.iterate(g,e)}var g=[].concat(a),h={},i={},j={};return f(),{getAll:function(){return g},get:function(a){return g[h[a]]},getByName:function(a){return g[i[a]]},getBy:function(a,b){return IX.map(j[a][b],function(a){return g[a]})},add:function(a){g.push(a),f()},update:function(a){var b=h[a.id];null!==b&&void 0!==b?g[b]=a:g.push(a),f()},remove:function(a){g[a.id]=null,f()},refresh:function(a){g=[].concat(a),f()}}}function b(a){c=$XP(a,"name",""),d.refresh($XP(a,"sites",[])),e.refresh($XP(a,"roles",[])),f.refresh($XP(a,"levels",[]))}var c="",d=new a([],["type"]),e=new a([],["siteType"]),f=new a([],["level"]),g=TCM.Const.SiteTypeNames;IX.ns("TCM.LineInfo"),TCM.LineInfo.init=function(a){b(a)},TCM.LineInfo.refresh=function(a){b(a)},TCM.LineInfo.destroy=function(){c="",d.refresh([]),e.refresh([]),f.refresh([])},TCM.LineInfo.getName=function(){return c},TCM.LineInfo.setName=function(a){c=a},TCM.LineInfo.getSites=function(){return d},TCM.LineInfo.getSiteName=function(a){var b=d.get(a);return b?b.name:""},TCM.LineInfo.getRoles=function(){return e},TCM.LineInfo.getRoleName=function(a){var b=e.get(a);return b?b.name:""},TCM.LineInfo.getSiteTypeNameOfRole=function(a){var b=e.get(a);return b&&null!==b.siteType?g[b.siteType]:""},TCM.LineInfo.getLevels=function(){return f},IX.ns("TCM.DeviceType"),TCM.DeviceType.getNodeName=function(a){switch(a){case TCM.Const.DeviceTypes.TNM:case TCM.Const.DeviceTypes.TVS:case TCM.Const.DeviceTypes.TAS:case TCM.Const.DeviceTypes.TVR:return"server";case TCM.Const.DeviceTypes.Storage:return"storage";case TCM.Const.DeviceTypes.IPCFixed:case TCM.Const.DeviceTypes.IPCSemiSphere:case TCM.Const.DeviceTypes.IPCSphere:return"IPC";case TCM.Const.DeviceTypes.CameraFixed:case TCM.Const.DeviceTypes.CameraSemiSphere:case TCM.Const.DeviceTypes.CameraSphere:return"camera";case TCM.Const.DeviceTypes.RedirectPickup:case TCM.Const.DeviceTypes.OmnidirectPickup:return"pickup";case TCM.Const.DeviceTypes.Coder:return"coder";case TCM.Const.DeviceTypes.Decoder:return"decoder";case TCM.Const.DeviceTypes.SpecialDecoder:return"specialDecoder";case TCM.Const.DeviceTypes.Spliter:return"spliter";case TCM.Const.DeviceTypes.Monitor:return"monitor";case TCM.Const.DeviceTypes.Terminal:return"terminal";case TCM.Const.DeviceTypes.VDM:return"vdm";case TCM.Const.DeviceTypes.HUB:case TCM.Const.DeviceTypes.PDH:case TCM.Const.DeviceTypes.FiberConvertor:case TCM.Const.DeviceTypes.KVM:case TCM.Const.DeviceTypes.PDU:case TCM.Const.DeviceTypes.Other:return"other"}}}(),function(){IX.ns("TNM.Util");var a=5e3;TNM.Util.PeriodicChecker=function(b,c,d){function e(){return IX.isFn(b)&&!b()?void(f=!1):(h=setTimeout(function(){f&&e()},g),void c(function(a){return!1}))}var f=!1,g=d||a,h=null;return{start:function(){f||e(),f=!0},stop:function(){f=!1,clearTimeout(h)}}},TNM.Util.KickChecker=function(b,c,d){function e(){return IX.isFn(b)&&!b()?void(f=!1):(h=function(){return setTimeout(function(){f&&e()},g)},void c(f,h))}var f=!1,g=d||a,h=null;return{start:function(){f||e(),f=!0},stop:function(){f=!1,clearTimeout(h)}}}}(),function(){function a(a){var b=$XP(a,"name"),c=$XP(a,"title",b),d=$XP(a,"isLongStr");return{getTitleTpldata:function(){return{html:IX.encodeTXT(c),name:b,sortClz:"up"}},getCellTpldata:function(a){return{name:b,html:IX.encodeTXT($XP(a,b,"")),title:d?IX.encodeTXT($XP(a,b,"")):"",longClz:d?"longName":""}}}}function b(a,b,c,d){function e(){return IX.map(b,function(b){return b.getCellTpldata(a)})}function f(){return IX.loop(c,[],function(a,b){return a.push({name:b[0],title:b[1],html:""}),a})}function g(){return IX.map(d,function(a){return{name:a[0],html:a[1]}})}var h=a.id,i={id:h,clz:"",moreClz:0===d.length?"hidden":"",dropdowcActs:g(),cells:e(),actions:f()};return{getId:function(){return h},get:function(b){return $XP(a,b)},refresh:function(b){a=b,i.cells=e()},getTpldata:function(){return i}}}var c={};IX.ns("IXW.Lib"),IXW.Lib.GridModel=function(a,d){function e(a,b){n.load(a,g,function(a){m.rows=IX.map(a,function(a){return a.getTpldata()}),b(a)})}var f=$XP(d,"clz",""),g=$XP(d,"pageSize",20),h=$XP(d,"rowModel",b),i=$XF(d,"dataLoader"),j=IX.map($XP(d,"columns",[]),function(a){return a in c?new c[a]:null}),k=$XP(d,"actions",[]),l=$XP(d,"moreActions",[]),m={clz:f,id:a,header:IX.map(j,function(a){return a.getTitleTpldata()}),rows:[]},n=new IX.IPagedManager(function(a){return new h(a,j,k,l)},null,i);return{getDataModel:function(){return n},getRow:n.get,getFirst:n.getFirst,addItems:n.addItems,removeItems:n.removeItems,getTotal:function(){return n.getTotal()},getTpldata:function(){return m},getPageCount:function(){return Math.ceil(n.getTotal()/g)},resetPage:function(a,b,c){g=b,e(a,c)},load:function(a,b){e(a,b)}}},IXW.Lib.GridModel.RowModelBase=b,IXW.Lib.GridModel.ColumnModelBase=a,IXW.Lib.GridModel.registerColumnModel=function(a,b){c[a]=b}}(),function(){function a(a,b,c,d){var f=new e({name:a,title:b});return f.getCellTpldata=function(b){return{name:a,html:c(b),title:d?c(b):"",longClz:d?"longName":""}},f}function b(a,b){var c=a[b];return l.renderData("",{name:g.getRoleName(c.id)||"预留",type:g.getSiteTypeNameOfRole(c.id),prompt:c.prompted?"需要启动临时授权":""})}function c(a){return{getTitleTpldata:function(){return{name:"role",html:m[a]}},getCellTpldata:function(c){return{name:"role",html:b(c,a),title:"",longClz:""}}}}var d=IXW.Lib.GridModel,e=d.ColumnModelBase,f=d.registerColumnModel,g=TCM.LineInfo,h=TCM.Const.SiteTypeNames,i=TCM.Const.UserTypeNames,j=TCM.Const.DeviceTypeNames,k=new IX.ITemplate({
tpl:["<div>{title}</div>","<ul>",'<li class="col-role-name">角色名称</li>','<li class="col-role-type">所属单位类型</li>','<li class="col-role-prompt {clz}">特殊处理</li>',"</ul>"]}),l=new IX.ITemplate({tpl:["<ul>",'<li class="col-role-name">{name}</li>','<li class="col-role-type">{type}</li>','<li class="col-role-prompt">{prompt}</li>',"</ul>"]}),m={station:k.renderData("",{title:"车站优先级说明",clz:"prompt1"}),depot:k.renderData("",{title:"车辆端／停车场优先级说明",clz:"prompt2"})},n={html:"<span class='checkbox'></span>",name:"_check",title:"",longClz:""};IX.iterate([["_checkbox",function(){return{getTitleTpldata:function(){return n},getCellTpldata:function(){return n}}}],["_no","序号"],["name",{name:"name",title:"名称",isLongStr:!0}],["desc",{name:"desc",title:"说明",isLongStr:!0}],["siteNo",{name:"no",title:"序号"}],["siteType",function(){return a("type","单位类型",function(a){return h[a.type]||""},!0)}],["roleName",{name:"name",title:"角色名称",isLongStr:!0}],["roleType",function(){return a("type","角色所属单位类型",function(a){return h[a.siteType]||""},!0)}],["rolePromptable",function(){return a("promptable","特殊情况下是否允许启动临时授权",function(a){return a.promptable?"允许":""})}],["levelName",{name:"name",title:"级别"}],["station",function(){return c("station")}],["depot",function(){return c("depot")}],["userName",{name:"name",title:"用户名称"}],["account","登录名称"],["utype",function(){return a("type","用户类型",function(a){return i[a.type]||""},!0)}],["userSite",function(){return a("site","所属单位",function(a){return g.getSiteName(a.siteId)},!0)}],["userRole",function(){return a("role","角色名称",function(a){return g.getRoleName(a.role)},!0)}],["devNo","编号"],["devType",function(){return a("type","设备类型",function(a){return j[a.type]||""},!0)}],["devName",function(){return a("name","名称",function(a){return a.name||""},!0)}],["devProvider",function(){return a("provider","厂家",function(a){return a.provider||""},!0)}],["devStyle",function(){return a("style","型号",function(a){return a.style||""},!0)}],["devDesc",function(){return a("desc","备注",function(a){return a.desc||""},!0)}],["devIp",function(){return a("ip","IP地址",function(a){return a.ip||""},!0)}],["devPort",function(){return a("port","端口号",function(a){return a.port||""})}],["devChannelNum",function(){return a("channelNum","通道数",function(a){return a.channelNum||""})}],["devVersion",function(){return a("version","软件版本",function(a){return a.version||""})}],["devbcPort",function(){return a("bcPort","组播流端口",function(a){return a.bcPort||""})}],["devdiskNum",function(){return a("diskNum","设备硬盘数量",function(a){return a.diskNum||""})}],["devdriverId",function(){return a("driverId","驱动ID",function(a){return a.driverId||""})}],["devCapacity",function(){return a("capacity","存储总容量",function(a){return a.capacity||""})}],["devPath",function(){return a("path","软件名称或网页地址",function(a){return a.path||""},!0)}],["devRelatedSpliter",function(){return a("relatedSpliter","关联画面分割器",function(a){return a.relatedSpliter||""})}],["devControlType",function(){return a("controlType","云台控制类型",function(a){return a.controlType||""})}],["devControlParams",function(){return a("controlParams","云台控制参数",function(a){return a.controlParams||""})}],["devBitsets",function(){return a("bitsets","预置位定义",function(a){return a.bitsets||""})}],["devMaxWindow",function(){return a("maxWindow","最大画面数",function(a){return a.maxWindow||""})}],["devUserName",function(){return a("userName","用户名",function(a){return a.username||"admin"},!0)}],["devPassWord",function(){return a("password","密码",function(a){return a.password||"******"})}],["num","数量"],["zno","编号"],["zname","名称"],["dname","摄像机名称"],["dstat","录像状态"],["startDate","录像开始时间"],["endDate","录像结束时间"],["range",function(){var a=new e({name:"range",title:"完整录像周期显示"});return a.getCellTpldata=function(a){return{name:"range",html:"<span class='range'></span>"}},a}],["fauFaultDate",function(){return a("faultDate","告警时间",function(a){return IX.Date.format(new Date(1e3*a.faultDate))||""},!0)}],["fauSiteId",function(){return a("siteId","告警车站",function(a){var b=null;return IX.iterate(TCM.LineInfo.getSites().getAll(),function(c){c.id==a.siteId&&(b=c.name)}),b||""},!0)}],["fauDeviceName",function(){return a("deviceName","设备名称",function(a){return a.deviceName||""},!0)}],["fauDeviceIp",function(){return a("deviceIp","IP地址",function(a){return a.deviceIp||""},!0)}],["fauLevel",function(){return a("level","告警级别",function(a){return TNM.Const.FaultLevels[a.level]||""},!0)}],["fauIsHandled",function(){return a("isHandled","处理标志",function(a){return a.isHandled?'<span class="handle">已处理</span>':'<span class="notHandle"></span>'})}],["fauCode",function(){return a("code","告警内容",function(a){return TNM.Const.FaultFormats[a.code]||""},!0)}],["fauDesc",function(){return a("desc","",function(a){return a.desc||""})}],["logUserName",function(){return a("userName","操作用户",function(a){return a.userName||""},!0)}],["siteName",function(){return a("siteName","设备所属车站",function(a){return a.siteName||""},!0)}],["logDeviceName",function(){return a("deviceName","设备名称",function(a){return a.deviceName||""},!0)}],["logOpDate",function(){return a("opDate","操作时间",function(a){return IX.Date.format(new Date(1e3*a.opDate))||""},!0)}],["logOpType",function(){return a("opType","操作类型",function(a){return TNM.Const.LogType[a.opType]||""},!0)}],["logIp",function(){return a("ip","IP",function(a){return a.ip||""},!0)}],["logDesc",function(){return a("desc","",function(a){return a.desc||""})}],["troDeviceName",function(){return a("deviceName","设备名称",function(a){return a.deviceName||""},!0)}],["troNum",function(){return a("opNum","故障次数",function(a){return a.opNum||""},!0)}],["troDesc",function(){return a("desc","",function(a){return Array.isArray(a.desc)?IX.loop(a.desc,"",function(a,b,c){return a+='<div class="tro-desc">(发生'+b.num+"次): "+TNM.Const.FaultFormats[b.opType]+"</div>"}):""})}],["details",function(){return a("details","",function(a){return"<div class='arr-up'></div><span class='desc-detail'></span>"})}],["baseName",function(){return a("name","服务器名称",function(a){return a.name||""},!0)}],["baseType",function(){return a("type","服务类型",function(a){return TCM.Const.DeviceTypeNames[a.type]||""},!0)}],["baseIP",function(){return a("ip","IP地址",function(a){return a.ip||""},!0)}],["baseVersion",function(){return a("version","版本信息",function(a){return a.version||""},!0)}]],function(a){var b=a[0],c=a[1];f(b,IX.isFn(c)?c:function(){return new e(IX.isString(c)?{name:b,title:c}:c)})})}(),function(){function a(a,b){return d.renderData("",IX.inherit({valueId:a,comboId:a+"_combo"},b)).replaceAll("{action}","nvcombo.pick")}function b(a,b,c,d){return e.renderData("",{valueId:a,value:b,text:c,clz:b?"selected":""}).replaceAll("{action}",d||"nvcheckbox.check")}var c=IXW.Actions.configActions,d=new IX.ITemplate({tpl:['<span class="dropdown">','<input type="hidden" id="{valueId}" value="{value}">','<button class="dropdown-toggle" type="button" id="{comboId}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">','<span class="name" title="{valueText}">{valueText}</span><span class="pic-"></span>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{comboId}">','<tpl id="items">',"<li>",'<a data-href="${action}" data-key="{id}" title="{name}">{name}</a>',"</li>","</tpl>","</ul>","</span>",""]}),e=new IX.ITemplate({tpl:['<input type="hidden" id="{valueId}" value="{value}">','<a class="nv-checkbox {clz}" data-href="${action}">','<span class="ixpic-"></span><span>{text}</span></a>',""]});c([["nvcombo.pick",function(a,b){var c=a.key,d=b.innerHTML,e=$XH.ancestor(b,"dropdown");if(e){var f=$XD.first(e,"input");f.value=c;var g=$XH.first($XH.first(e,"dropdown-toggle"),"name");g.innerHTML=d}}],["nvcheckbox.check",function(a,b){var c=!$XH.hasClass(b,"selected");$XH[c?"addClass":"removeClass"](b,"selected");var d=$XD.first(b.parentNode,"input");d.value=c}]]),IX.ns("NV.Lib"),NV.Lib.getComboHTML=a,NV.Lib.getCheckboxHTML=b}(),function(){function a(a){var b=$XH.ancestor(a,"ixw-grid");return b?c[b.id]:null}var b=IXW.Actions.configActions,c={};b([["ixw.grid.col",function(b,c){var d=a(c);d&&d.colAction(b.key,c)}],["ixw.grid.cell",function(b,c){var d=a(c),e=$XH.ancestor(c,"row");d&&e&&d.cellAction($XD.dataAttr(e,"id"),b.key,c)}],["ixw.grid.action",function(b,c){
var d=a(c),e=$XH.ancestor(c,"row");d&&e&&d.rowAction($XD.dataAttr(e,"id"),b.key,e)}]]);var d=new IX.ITemplate({tpl:['<div id="{id}" class="ixw-grid {clz}">','<ul class="hdr">','<tpl id="header">','<li class="col-{name}">','<a data-href="$ixw.grid.col" data-key="{name}">',"<span>{html}</span>",'<span class="pic- hide"></span>',"</a>","</li>","</tpl>","</ul>",'<div class="body">','<tpl id="rows">','<ul data-id="{id}" class="row {clz}">','<tpl id="cells">','<li class="col-{name}">','<a class="cell {longClz}" data-href="$ixw.grid.cell" data-key="{name}" title = "{title}">{html}</a>',"</li>","</tpl>",'<li class="r col-actions invisible">','<div class="btns-group {moreClz}">','<a class="act-more dropdown-toggle" data-toggle="dropdown" title="更多操作"></a>','<ul class="dropdown-menu">','<tpl id="dropdowcActs">','<li><a data-href="$nvgrid.clickTool" data-key="{name}">{html}</a></li>',"</tpl>","</ul>","</div>",'<tpl id="actions">','<a class="act-{name}" data-href="$ixw.grid.action" data-key="{name}" title="{title}">{html}</a>',"</tpl>","</li>","</ul>","</tpl>","</div>","</div>",""]});IX.ns("IXW.Lib"),IXW.Lib.Grid=function(a){function b(){var a=$X(f);a&&(a.innerHTML=d.renderData("",i.getTpldata()))}function e(a){var b=$XH.first($X(g),"body");if(b&&!a){var c=i.getTpldata();b.innerHTML=IX.map(c.rows,function(a){return d.renderData("rows",a)}).join("")}}var f=$XP(a,"container"),g=a.id||IX.id(),h=IX.loop($XP(a,"actions",[]),{},function(a,b){return a[b[0]]=b[2],a}),i=new IXW.Lib.GridModel(g,a),j={getHTML:function(){return d.renderData("",i.getTpldata())},getId:function(){return g},getModel:function(){return i},show:function(){i.load(0,b)},refresh:function(a){e(a)},colAction:function(a,b){},cellAction:function(a,b,c){},rowAction:function(a,b,c){h[b](i.getRow(a),c)}};return c[g]=j,j}}(),function(){function a(a){return{id:a,indics:[{stx:0,endx:0,pagex:0}],paginHTML:"",pageInfo:j.text,list:IX.map(i,function(a){return{value:a.id,clz:a.id==j.id?"disabled":"",html:a.text}})}}function b(b){var c=new IXW.Lib.Pagination({id:b+"-pagin",total:0,current:0}),d=a(b);return d.paginHTML=c.getHTML(),{getHTML:function(){return h.renderData("",d)},getCurrentPageNo:function(){return c.getCurrentPageNo()},bind:function(a,d){c.bind(a),k[b]=function(a){d(0,a)}},jump:c.jump,refresh:function(a,e,f,g,i){c.apply(e,a,g),d.paginHTML=c.getHTML();var k=0!==i?e*j.value+1:0;d.indics=[{stx:k,endx:Math.max(k+f-1,0),pagex:i}];var l=$X(b+"-indics");!g&&l&&(l.innerHTML=h.renderData("indics",d.indics[0]))}}}function c(a,b){function c(b){var c=jQuery("#"+a+"_tool .chkEnable");c[b?"removeClass":"addClass"]("disabled")}var d={id:a,btns:IX.map($XP(b,"buttons",[]),function(a){return{name:a.name,clz:$XP(a,"chkEnabled",!0)?"chkEnable disabled":""}})};return m[a]=function(a){$XF(b,"actions."+a)()},{getHTML:function(){return l.renderData("",d)},enable:function(){c(!0)},disable:function(){c(!1)}}}function d(a){var b=/^([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;return b.test(a)}var e=IXW.Actions.configActions,f=(IXW.Lib.Grid,NV.Lib.getComboHTML),g=TCM.Const.DeviceTypeNames,h=new IX.ITemplate({tpl:['<div id="{id}-indics" class="l">','<tpl id="indics">',"从<span>{stx}</span>到<span>{endx}</span>/共<span>{pagex}</span>条数据","</tpl>","</div>",'<div class="m">{paginHTML}</div>','<div class="r">','<span>显示</span><div class="page">','<div class="dropdown">','<a class="changePage dropdown-toggle" data-toggle="dropdown">','<span id="curPage" class="pagesize">{pageInfo}</span><span class="pgFrame"><span class="pic-pg"></span></span>',"</a>",'<ul class="dropdown-menu">','<tpl id="list">','<li class="{clz}" id="{id}">','<a class="pagesize" data-href="$nvpagin.change" data-key="{value}" data-target="{id}">{html}</a>',"</li>","</tpl>","</ul>","</div></div>","</div>",""]}),i=[{id:"page-0",value:20,text:"每页20条"},{id:"page-1",value:50,text:"每页50条"},{id:"page-2",value:100,text:"每页100条"}],j=i[0],k={};e([["nvpagin.change",function(a,b){var c=b.parentNode;if(!$XH.hasClass(c,"disabled")){var d=$XH.ancestor(c,"dropdown"),e=$XH.first($XD.first(d,"a"),"pagesize");e.innerHTML=b.text,$XH.removeClass($XH.first(c.parentNode,"disabled"),"disabled"),$XH.addClass(c,"disabled"),j=i[a.key.split("-").pop()];var f=k[$XD.dataAttr(b,"target")];IX.isFn(f)&&f(j.value)}}]]);var l=new IX.ITemplate({tpl:['<div id="{id}_tool">','<tpl id="btns">','<a class="btn-{name} {clz}" data-href="$nvtool.click" data-target="{id}" data-key="{name}"></a>',"</tpl>","</div>",""]}),m={};e([["nvtool.click",function(a,b){if(!$XH.hasClass(b,"disabled")){var c=m[$XD.dataAttr(b,"target")];IX.isFn(c)&&c(a.key)}}]]);var n=new IX.ITemplate({tpl:['<div id="{id}" class="nv-grid nv-box {gridClz}">','<div class="nvgrid-title nv-title">{title}</div>','<div class="nvgrid-tools">{toolHTML}</div>','<div class="nvgrid-body">{gridHTML}</div>','<div class="nvgrid-foot">{paginHTML}</div>',"</div>",""]});IX.ns("NV.Lib"),NV.Lib.Grid=function(a){function d(){jQuery($X(k)).find(".row").hover(function(){$XH.addClass(this,"hover")},function(){$XH.removeClass(this,"hover")})}function e(){return jQuery("#"+l+"-grid").find(".row .selected")}function f(a,b,c){q.refresh(c),c||d(),s&&s.refresh(r.getPageCount(),a,b.length,c,r.getTotal()),t&&t.disable()}function g(a){r.load(a,function(b){f(a,b)})}function h(b){var c=$X(k);c&&(f(0,b,!0),c.innerHTML=n.renderData("",{id:l,gridClz:$XP(a,"clz",""),title:$XP(a,"title",""),toolHTML:t?t.getHTML():"",gridHTML:q.getHTML(),paginHTML:s?s.getHTML():""}),d())}function i(a){s?s.jump(a):g(0)}var k=$XP(a,"container"),l=a.id||IX.id(),m=$XP(a,"tools"),o=$XP(a,"usePagination",!0),p=$XF(a,"clickOnRow"),q=new IXW.Lib.Grid(IX.inherit(a,{id:l+"-grid",pageSize:j.value,dataLoader:$XF(a,"dataLoader")})),r=q.getModel(),s=null,t=null,u=IX.emptyFn;return m&&(t=new c(l,m),u=function(){var a=e();t[a.length>0?"enable":"disable"]()}),q.colAction=function(a,b){if("_check"==a){var c=jQuery(b),d=c.find(".checkbox").hasClass("selected"),e=c.parents(".ixw-grid").find(".col-_check .checkbox");e[d?"removeClass":"addClass"]("selected"),u()}},q.cellAction=function(a,b,c){if("_check"==b){$XH.toggleClass($XH.first(c,"checkbox"),"selected");var d=!0;jQuery(".ixw-grid .body").find(".checkbox").each(function(){$XH.hasClass(this,"selected")||(d=!1)});var e=jQuery(".ixw-grid").find(".hdr .checkbox")[0];d?$XH.addClass(e,"selected"):$XH.removeClass(e,"selected"),u()}else p(a,b,c)},o&&(s=new b(l),s.bind(g,function(a,b){r.resetPage(a,b,function(b){f(a,b)})})),{getModel:function(){return r},getSelectedRows:function(){return IX.map(e(),function(a){var b=$XH.ancestor(a,"row");return r.getRow($XD.dataAttr(b,"id"))})},addItems:function(a){r.addItems(a),i(r.getPageCount()-1)},removeItems:function(a){r.removeItems(a),i(Math.min(s?s.getCurrentPageNo():0,r.getPageCount()-1))},show:function(){r.load(0,h)},refresh:function(a){i(a)}}};var o,p=new IX.ITemplate({tpl:['<tpl id="toolItems">','<div class="tool {clz}"><span class="label">{text}:</span>{html}</div>',"</tpl>",'<div class="tool {clz}"><span class="label">{text}:</span>{fromCombo} -- {toCombo}</div>',""]}),q=new IX.ITemplate({tpl:['<a data-href="$grid.{value}" class="filterBtn tool-{value}"></a>',""]});e([["combo.change",function(a,b){var c=a.key,d=b.innerHTML,e=$XH.ancestor(b,"dropdown");if(e){var f=$XD.first(e,"input");f.value=c;var g=$XH.first($XH.first(e,"dropdown-toggle"),"name");g.innerHTML=d,jQuery(g).attr("title",d),window.location.href.indexOf("item")>0&&IXW.Pages.load("fault"),o.change()}}]]);var r={level:{id:"level",items:[{id:"all",name:"所有"}].concat(IX.loop("0".multi(2).split(""),[],function(a,b,c){return a.push({id:c+1,name:TNM.Const.FaultLevels[c+1]}),a}))},isHandled:{id:"isHandled",items:[{id:"all",name:"所有"},{id:!0,name:"已处理"},{id:!1,name:"未处理"}]},deviceType:{id:"deviceType",items:[{id:"all",name:"所有类型"}].concat(IX.loop("0-1-2-3-10-20-21-22-50-53-54-55-60-61-62-63-64-90".split("-"),[],function(a,b,c){return a.push({id:b,name:g[b]}),a}))},userId:{id:"userId",items:[{id:"all",name:"所有用户"}]}};IX.ns("TNM.Lib"),TNM.Lib.BaseFilterTools=function(a){function b(a,b){var c=new Date(1e3*parseInt(a)),d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes(),e=d.split(" ");
if(b){e[1]="00:00";for(var f=e[0].split("-"),g=1;3>g;g++)f[g].length<2&&(f[g]="0"+f[g]);e[0]=f.join("-"),d=e.join(" ")}return d}function c(a){var c=a.type;a.dataAttrs=[["key",c]],a.timeFmt="hh:mm",a.onchange=function(a){var c=Math.floor((new Date).getTime()/1e3),d=jQuery("[data-key='from']").find("input").val(),e=jQuery("[data-key='to']").find("input").val();d=new Date(d.replace(/-/g,"/")).getTime()/1e3,e=new Date(e.replace(/-/g,"/")).getTime()/1e3;var f;d>e&&(a==d?(f=b(e,!0),NV.Dialog.alert("开始时间必须小于结束时间！"),jQuery(".ixw-dpt:first input").attr("value",f)):(f=b(c,!1),NV.Dialog.alert("开始时间必须小于结束时间！"),jQuery(".ixw-dpt:last input").attr("value",f))),i()};var d=new IXW.Lib.DatePickTrigger(a);return d}function e(a,b){return f(a.id,{value:b?a.items[b].id:a.items[0].id,valueText:b?a.items[b].name:a.items[0].name,items:IX.loop(a.items,[],function(a,b,c){return a.push(IX.inherit(b,b.action?{}:{action:"combo.change"})),a})})}function g(a){return IX.loop(a,[],function(a,b,c){var d={clz:"userId"==b.id?b.id+" disable":b.id,text:b.text,html:"ip"==b.id?"<input id='ip' />":e(b.items?b.items:r[b.id],b.num?b.num:null)};return a.push(d),a})}function h(){if(l){var a=jQuery("[data-key='from']").find("input").val(),b=jQuery("[data-key='to']").find("input").val(),c=jQuery("#ip").val(),e=d(c);if(""!==a?(a=a.replace(/-/g,"/"),n.from=new Date(a).getTime()/1e3):n.from=null,""!==b?(b=b.replace(/-/g,"/"),n.to=new Date(b).getTime()/1e3):n.to=null,!e&&""!==c&&void 0!==c)return NV.Dialog.alert("IP地址格式不正确！"),!1;if(n.from>n.to)return NV.Dialog.alert("开始时间必须小于结束时间！"),!1}var f=IX.loop(k,{},function(a,b,c){return a[b.id]=$X(b.id).value,a});return IX.inherit(n,f)}function i(){j(h())}var j=null,k=$XP(a,"toolList",[]),l=$XP(a,"hasDate",""),m=$XP(a,"buttons",""),n={},o=a.defaultDate;return{getHTML:function(){var b=p.renderData("",{text:$XP(a,"dateText")||"时间",clz:l?"date":"disabled",fromCombo:c({type:"from",value:o?"default"==o?TNM.Lib.GetCurDay().from:o:"",label:""}).getHTML(),toCombo:c({type:"to",value:o?"default"==o?TNM.Lib.GetCurDay().to:o+60:"",label:""}).getHTML(),toolItems:g(k)});return m?IX.loop(m,"",function(a,b,c){return a+=q.renderData("",b)})+b:b},change:i,getFilterParams:function(){return h()},onchange:function(a){j=a}}},TNM.Lib.GetCurDay=function(){function a(a,b){a=a.split("-");var c=new Date;return c.setUTCFullYear(a[0],a[1]-1,a[2]),"from"==b?c.setUTCHours(-8,0,0,0):c.setUTCHours(16,0,0,0),c}function b(b){var c=new Date,d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();return a(d,b).getTime()/1e3}return{from:b("from"),to:b("to")}},TNM.Lib.FilterGrid=function(a){function c(){jQuery($X(i)).find(".row").hover(function(){$XH.addClass(this,"hover")},function(){$XH.removeClass(this,"hover")})}function d(){return jQuery("#"+k+"-grid").find(".row .selected")}function e(a,b,d){q.refresh(d),d||c(),s&&s.refresh(r.getPageCount(),a,b.length,d,r.getTotal())}function f(a){r.load(a,function(b){e(a,b)})}function g(b){var d=$X(i);d&&(e(0,b,!0),d.innerHTML=n.renderData("",{id:k,gridClz:$XP(a,"clz",""),title:$XP(a,"title",""),toolHTML:o?o.getHTML():"",gridHTML:q.getHTML(),paginHTML:s?s.getHTML():""}),c())}function h(a){s?s.jump(a):f(0)}var i=$XP(a,"container"),k=a.id||IX.id(),l=$XP(a,"usePagination",!0);o=$XP(a,"tools");var m=$XP(a,"baseParams"),p=null,q=new IXW.Lib.Grid(IX.inherit(a,{id:k+"-grid",pageSize:j.value,dataLoader:function(b,c){p&&p.query&&(b.pageNo=0);var d=IX.inherit(b,m,p);p&&(p.query=!1),$XF(a,"dataLoader")(d,c)}})),r=q.getModel(),s=null;IX.emptyFn;l&&(s=new b(k),s.bind(f,function(a,b){r.resetPage(a,b,function(b){e(a,b)})}));var t={getModel:function(){return r},getSelectedRows:function(){return IX.map(d(),function(a){var b=$XH.ancestor(a,"row");return r.getRow($XD.dataAttr(b,"id"))})},show:function(){r.load(0,g)},refresh:function(a){h(a)}};return t.show(),o.onchange(function(a){a&&(a.query=!0,p=a,t.refresh(0))}),t}}(),function(){function a(a){var b=$XH.ancestor(a,"nv-tree");return b?e[b.id]:null}var b=new IX.ITemplate({tpl:["<ul>",'<tpl id="items">','<li class="{expandClz}">','<a class="{clz}" data-href="$tree.click" data-key="{key}" data-siteId="{siteId}" title="{name}" data-name="{name}" data-zoneId="{zoneId}">','<span class="pic-expand"></span>',"<span>{html}</span>","</a>{HTML}","</li>","</tpl>","</ul>",""]}),c=new IX.ITemplate({tpl:['<div class="nv-tree" id="{id}">{html}</div>',""]}),d=IXW.Actions.configActions,e={};d([["tree.click",function(b,c,d){if($XH.hasClass(d.target,"pic-expand")){var e=jQuery(c).parent().get(0);"none"==jQuery(c).parent().children("ul").css("display")?(jQuery(c).parent().children("ul").slideDown(),$XH.hasClass(e,"none")||($XH.removeClass(e,"rotation"),$XH.removeClass(e,"expand"),$XH.addClass(e,"fold"))):(jQuery(c).parent().children("ul").slideUp(),$XH.hasClass(e,"none")||($XH.removeClass(e,"fold"),$XH.addClass(e,"expand"),$XH.addClass(e,"rotation")))}else{if("{key}"==b.key)return;jQuery(".nv-tree").find("a").removeClass("select"),jQuery(c).addClass("select"),a(c)({keys:b.key,siteId:$XD.dataAttr(c,"siteId"),name:$XD.dataAttr(c,"name"),zoneId:$XD.dataAttr(c,"zoneId"),el:c})}}]]),IX.ns("TCM.Lib"),TCM.Lib.Tree=function(a){function d(c){return b.renderData("",{items:IX.map(c,function(b){var c=0===b.nodes.length?"":d(b.nodes);return{clz:b.key?"node-"+b.key.join("-"):"node",expandClz:""===c?"none":"expand",html:a.htmlFn(b),key:b.key,siteId:b.siteId,name:b.name,zoneId:b.zoneId,HTML:c}})})}function f(){return c.renderData("",{id:g,html:d(a.nodes)})}var g=($XP(a,"container"),IX.id());e[g]=$XF(a,"click");var h={getHTML:function(){return f()},refresh:function(){}};return h}}(),function(){function a(){e&&e.hide()}function b(a){a.className="ixw-body nv-dialog "+$XP(f,"clz",""),a.innerHTML=g.renderData("",{title:$XP(f,"title",""),content:$XP(f,"content",""),lbtns:$XP(f,"btns.left",i.left),rbtns:$XP(f,"btns.right",i.right)}),$XF(f,"afterShow")(a)}function c(a){f=a,0===jQuery(".confirmLogin").length&&(e||(e=new IXW.Lib.ModalDialog({id:"nv-dialog",bodyRefresh:b})),e.show())}var d=IXW.Actions.configActions,e=null,f=null,g=new IX.ITemplate({tpl:['<div class="head">{title}</div>','<div class="content">{content}</div>','<div class="foot">','<div class="l btns">','<tpl id="lbtns">','<a class="btn {name}btn" data-href="$nvdialog-click" data-key="{name}">{text}</a>',"</tpl>","</div>",'<div class="r btns">','<tpl id="rbtns">','<a class="btn {name}btn" data-href="$nvdialog-click" data-key="{name}">{text}</a>',"</tpl>","</div>","</div>	",""]}),h=new IX.ITemplate({tpl:['<div class="area confirm"><div class="msg">{msg}</div></div>',""]}),i={left:[],right:[{name:"ok",text:"确定"},{name:"cancel",text:"取消"}]};d([["nvdialog-click",function(b,c){var d=b.key;return"cancel"===d?a():void $XF(f,"listen."+d)()}],["ixw.alert.close",function(a,b){jQuery($XH.ancestor(b,"ixw-alert")).removeClass("animate-shake"),jQuery("#IXW-alert").fadeOut()}]]),IX.ns("NV.Dialog"),NV.Dialog.show=c,NV.Dialog.hide=a,NV.Dialog.confirm=function(b,d,e){c({title:IX.encodeTXT(b),content:h.renderData("",{msg:d}),listen:{ok:function(){e(a)}}})},NV.Dialog.confirm4login=function(b,d,e,f){c({title:IX.encodeTXT(b),clz:"confirmLogin",btns:e,content:h.renderData("",{msg:d}),listen:{ok:function(){f(a)}}})},NV.Dialog.alert=function(a){var b=IXW.Lib.alert(a);$XH.addClass($XH.first(b,"ixw-alert"),"animate-shake")}}(),function(){function a(a,b,c,d){var e={deg:b-("right"==a?180:360),duration:c,delay:d},f={name:a,div:j.replaceByParams(e)};return e.deg=0-e.deg,f.span=j.replaceByParams(e),f}function b(b,c){if(180>=b&&180>=c)return[a("right",c,g,0)];if(b>=180&&c>=180)return[a("left",c,g,0)];var d=c>b?["right","left"]:["left","right"],e=Math.floor(100*g*(180-b)/(c-b))/100;return[a(d[0],180,e,0),a(d[1],c,g-e,e)]}function c(a,c,d){if(a&&c!=d){var e=b(c,d);a.style.cssText=i.replaceByParams({deg:d+95});var f=$XH.first(a.parentNode,"circle");IX.iterate(e,function(a){var b=$XH.first(f,a.name);if(b){var c=$XH.first(b,"pic-");b.style.cssText=a.div,c.style.cssText=a.span}}),10>d||d>350&&360>d?(jQuery(a.parentNode).find(".top").css("display","none"),jQuery(a).find("span").css("display","none")):(jQuery(a.parentNode).find(".top").css("display","block"),jQuery(a).find("span").css("display","block"))}}function d(a,b,c){var d=null,e=a.toString();
return"cpu"==c?(d=IX.loop(e.split(""),"",function(a,b,c){return a+="."==b?'<span class="point"></span>':'<span class="num'+b+'"></span>'}),d+='<span class="'+b+'"></span>'):(d=IX.loop(e.split(""),"",function(a,b,c){return a+="."==b?'<span class="points"></span>':'<span class="nums'+b+'"></span>'}),d+='<span class="'+b+'s"></span>'),d}function e(a,b){var e=0,f=1,h=$XH.first(a,"info"),i=$XH.first(a,"pointer");return{reset:function(j,k){var l=$XD.first($XH.first(a,"title"),"span");l.innerHTML=b.title.replace("{total}",j),h.innerHTML=d(k,b.unit,b.type),f=Math.max(1,j),e=360*k/f,setTimeout(function(){c(i,360,e)},1e3*g+100),c(i,0,360)},pointTo:function(a){h.innerHTML=d(a,b.unit,b.type);var g=360*a/f;c(i,e,g),e=g}}}function f(a,b){function c(a,c){b(function(b){IX.iterate(g,function(c){f||d[c].reset.apply(null,b[c]),a(d[c],b[c])}),f=!0},function(a){f=!1;var b=window.location.href;return b=b.slice(b.length-4),c?!1:void("perf"==b&&NV.Dialog.alert(a.err))})}var d={},f=!1,g=IX.map(k,function(b){var c=b.type;return d[c]=new e($XH.first(a,c),b),c});return{init:function(){c(function(a,b){a.reset.apply(null,b)},null)},refresh:function(a){c(function(a,b){a.pointTo(b[1])},a)}}}var g=3,h=IX.CSSVendorName,i=h+"transform:rotate({deg}deg);",j=h+"transform:rotate({deg}deg);"+h+"transition:all {duration}s linear {delay}s;",k=[{type:"mem",value:0,unit:"GB",title:"内存（共{total}GB）"},{type:"cpu",value:0,unit:"percent",title:"CPU"},{type:"disk",value:0,unit:"GB",title:"磁盘（共{total}GB）"}],l=new IX.ITemplate({tpl:['<tpl id="items">','<div class="dashboard {type}">','<div class="info">',"</div>",'<div class="centre"></div>','<div class="circle">','<div class="top"></div> ','<div class="left"><span class="pic-"></span></div>','<div class="right"><span class="pic-"></span></div>',"</div>",'<div class="pointer"><span class="pic-"></span></div>','<div class="title"><span>{title}</span></div>',"</div>	","</tpl>",""]}),m=l.renderData("",{items:k});IX.ns("TNM.Lib"),TNM.Lib.DashboardPanel=function(a,b){var c=$X(a);c.innerHTML=m.replaceAll("{total}",0);var d=new f(c,b);return d}}(),function(){function a(a){function b(){var a=1,b=0,e=document.getElementById("body"),g=e.clientWidth;g>1200?(a=1,b=Math.floor((g-160)/(n.length-1))):(a=Math.floor(g/1200*100)/100,.5>a&&(a=.5),b=Math.floor(1040/(n.length-1))),$X("siteLine").style.cssText=d.replaceByParams({deg:a,top:"50%"}),f(n,b,a),i(n,b,a),c(a),jQuery("#container").css({height:e.clientHeight-45+"px"})}function c(a){jQuery("#siteLine .text").each(function(b,c){c.style.cssText=d.replaceByParams({deg:1/a,top:o[b]+"px"})})}function f(a,b){var c=50;IX.iterate(a,function(a,d){jQuery(a).css({left:b*d+50+"px"}),c+=b}),jQuery(".line").css({left:"60px",width:c-b-50+"px"})}function h(a,b,c){if(!(c>60)){var d=64-c,e=0;IX.iterate(a,function(a,f){var g=b-f,h=f-b;e=(b>f?Math.floor(50-d/Math.sqrt(Math.sqrt(g))):Math.floor(50+d/Math.sqrt(Math.sqrt(h))))+c*f,b==f&&(e=c*f+50),jQuery(a).css({left:e+"px"})}),jQuery(".line").css({left:Math.floor(60-d/Math.sqrt(Math.sqrt(b)))+"px",width:e-50+Math.floor(Number(b)?d/Math.sqrt(Math.sqrt(b)):5)+"px"})}}function i(a,b){var c=jQuery(".site").find("a"),d=null;c.unbind("hover"),c.hover(function(){d=jQuery(this).attr("data-idx"),parseInt(d)%2===0?jQuery(this).find(".text").css("top",o[d]-25+"px"):jQuery(this).find(".text").css("top","65px"),h(a,$XD.dataAttr(this,"idx"),b)},function(){d=jQuery(this).attr("data-idx"),jQuery(this).find(".text").css("top",o[d]+"px"),f(a,b)})}function j(a){IX.iterate(a,function(a,b){jQuery(n[b]).find("a").removeClass().addClass("level"+a.level)})}function k(){n=jQuery("#siteLine").find(".site");for(var a=0;a<n.length;a++){var b=jQuery(n[a]).find(".ver-text").height();a%2===0?o[a]=-1*b-25:o[a]=45}}function l(a){a&&j(a)}function m(c){if(c){var d=$X(a);d&&(d.innerHTML=g.renderData("",{items:TNM.Lib.verticalText(c)}),k(),b())}}var n=null,o={};return{refresh:function(){e("getFault4Station",{},m)},refreshFaultStatus:function(a){e("getFault4Station",{},l,a)},resize:function(){b()}}}var b=IXW.Actions.configActions,c=IXW.Pages,d=IX.CSSVendorName+"transform:scale({deg});top: {top}",e=TNM.Global.sysCaller,f=new IX.ITemplate({tpl:['<li class="site">','<a class="{levelClz}" data-idx="{idx}" data-key="{key}" data-href="$site.click">','<div class="center"></div>','<div class="inside"></div>','<div class="outside"></div>','<div class="text">{name}</div>',"</a>","</li>",""]}),g=new IX.ITemplate({tpl:['<ul id="siteLine">','<li class="line"></li>','<tpl id="items">',f.renderData("",{key:"{id}",levelClz:"level{level}"}),"</tpl>","</ul>",""]});b([["site.click",function(a,b,d){$XH.hasClass(b,"level0")?c.load(c.createPath("sys-rack",{id:a.key})):(jQuery("#body").children().remove(),c.load(c.createPath("fault-site",{id:a.key})),jQuery("#nav-sys").removeClass("active"),jQuery("#nav-fault").addClass("active"))}]]),IX.ns("TNM.Lib"),TNM.Lib.SitesPanel=function(b){var c=new a(b);return IX.inherit(c,{check:function(a){c&&$XD.first($X("container"),"ul")&&c.refreshFaultStatus(a)}})}}(),function(){function a(a,b){for(var c=0,d=0;b>d;d++)c+=1<<d;return c<<a}function b(){IX.Net.loadFile(TNM.Global.rackDeviceDefintionUrl,function(a){var b=JSON.parse(a),c={};IX.iterate(v,function(a){var d=t[a];c[d]=b[u[d]]}),z=c})}function c(a,b,c){var d=$XP(z,a+"."+b+"U","default-"+b);return d+=c?"-"+c:"",A(d+".png")}function d(a,b){E(a.title,"请确认是否"+a.info+"？",function(c){s(a.callerName,a.params,function(){c(),b()})})}function e(a,b,c){function d(a,b,c){var d=isNaN(c)?b[0]:{id:c,name:c};return NV.Lib.getComboHTML(a,{value:d.id,valueText:d.name,items:b})}function e(a,b,d){return a.size>12?(p("一个设备最多占用12U！"),!1):void s("addDevice",a,function(){c.addDevice(b),d()})}function f(a,b,d){return a.size>12?(p("一个设备最多占用12U！"),!1):void s("moveDevice",a,function(){c.move(b),d()})}function g(){for(var d=$X("device4Rack").value,g=$X("stxPosInRack").value-1,l=$X("endPosInRack").value-1,n=Math.min(g,l),o=Math.max(g,l),q=n;o>=q;q++)if(-1!=h[q]&&(j||h[q]!=k))return p("请重新选择合适的机柜位置，选中的机柜位置已被其他设备占用！");var r=Math.min(g,l),t=Math.max(g,l)-r+1;if(!j&&k==d&&a.pos==r&&a.size==t)return D();var u={siteId:b,deviceId:d,rackId:i,pos:r,size:t},v=IX.Array.indexOf(m,function(a){return a.id==d}),w=B.newDevice(IX.inherit(m[v],{pos:r,size:t}));return j?e(u,w,D):k==d?f(u,w,D):void NV.Dialog.confirm("更换设备确认","您选择了新的设备，原设备将从该机柜中移除，是否确定？",function(){s("removeDevice",{siteId:b,rackId:i,deviceId:k},function(){c.remove(k),e(u,w,D)})})}var h=c.getMask(),i=c.getId(),j=!("id"in a),k=j?null:a.id,l=TCM.LineInfo.getSiteName(b),m=j?[]:[a],n=IX.loop(h,[],function(a,b,c){return(-1===b||!j&&b==k)&&a.push({id:c+1,name:c+1}),a});if(0===n.length)return p("机柜中没有可以添加设备的位置！");var o={siteName:l,rackName:c.getName(),deviceCombo:"",stxPosCombo:d("stxPosInRack",n,a.pos+1),endPosCombo:d("endPosInRack",n,a.pos+1+a.size-1)};s("getDevicesNotInRack",{siteId:b},function(a){return m=m.concat(a),0===m.length?p("没有可以添加到机柜的设备！"):(o.deviceCombo=d("device4Rack",m),void C({clz:"editDeviceInRack",title:j?"新增设备入机柜":"修改机柜中的设备",content:F.renderData("",o),listen:{ok:g}}))})}function f(a,b){var c=w-b-1,d=a+"-"+b,e=G.renderData("",{id:d,idx:b,top:c*x});return{isDevice:function(){return!1},getIdx:function(){return b},getHTML:function(){return e},remove:function(){var a=$X("board-"+d);a&&a.parentNode.removeChild(a)}}}function g(a){function b(){var a=$X("device-"+e);if(a){var b=$XH.first(a,"fault"),c=$XH.first(b,"max"),d=$XH.first(b,"min");c.src=j.maxFaultImg,d.src=j.minFaultImg,$XD.setDataAttr(b,"level",i),a.className="device level"+i+" U"+f}}function d(a){i=a,j=IX.inherit(j,{level:i,minFaultImg:0===i?"":c(g,f,i+"-0"),maxFaultImg:0===i?"":c(g,f,i+"-1")}),b()}var e=a.id,f=a.size||1,g=a.type,h=a.pos||0,i=0,j={id:e,unit:f,height:f*x,top:(w-a.pos-f)*x,img:c(g,f)};return d($XP(a,"level",0)),{getId:function(){return e},isDevice:function(){return!0},getIdx:function(){return a.pos},getHTML:function(){return H.renderData("",j)},getRange:function(){return[h,h+f-1]},getAttr:function(){return a},move:function(){var a=$X("device-"+e);a&&a.parentNode.replaceChild(jQuery(H.renderData("",j)).get(0),a)},remove:function(){var a=$X("device-"+e);a&&a.parentNode.removeChild(a)},refresh:b,setLevel:d,clearLevel:function(){d(0)}}}function h(a,b){function c(a){
for(var b=a.getRange(),c=a.getId(),d=b[0];d<b[1]+1;d++)j[d]=c;return b[0]}function d(a){jQuery("#device-"+a).remove();var b=[];for(h=0;w>h;h++)if(j[h]==a){j[h]=-1;var c=new f(i,h);b.push(c.getHTML()),k.push(c)}jQuery(b.join("")).appendTo("#rack-"+i+" ul")}function e(a){var b=c(a);k=IX.loop(k,[],function(c,d){var e=d.getIdx();return d.isDevice()||-1===j[e]?c.push(d):e==b?c.push(a):d.remove(),c}),jQuery(a.getHTML()).appendTo("#rack-"+i+" ul")}function g(a){var b=a.getRange(),c=a.getId(),d=[],e=null;for(h=0;w>h;h++)(j[h]==c||-1===j[h])&&(-1==j[h]&&h>=b[0]&&h<=b[1]?(e=new f(i,h),e.remove(),j[h]=c):j[h]!=c||h>=b[0]&&h<=b[1]||(e=new f(i,h),d.push(e.getHTML()),k.push(e),j[h]=-1));a.move(),k=IX.loop(k,[],function(a,b){var c=b.getIdx();return(b.isDevice()||-1==j[c])&&a.push(b),a}),jQuery(d.join("")).appendTo("#rack-"+i+" ul")}var h,i=a.id,j=IX.Array.init(w,-1),k=[];for(IX.iterate(b,function(a){k.push(a),c(a)}),h=0;w>h;h++)-1==j[h]&&k.push(new f(i,h));return{getMask:function(){return j},getId:function(){return i},getName:function(){return a.name},setName:function(b){a.name=b},getTpldata:function(){return IX.inherit(a,{html:IX.map(k,function(a){return a.getHTML()}).join("")})},trySetDevice:function(a,b,c){for(h=b;c>h;h++)if(-1!==j[h]&&j[h]!=a)return!1;return!0},addDevice:e,move:g,remove:d}}function i(a){var b=IX.map("name,provider,ip,style,desc".split(","),function(b){return{clz:b,label:K[b],text:IX.encodeTXT(a[b])}});return a.level>0&&b.unshift({clz:"level"+a.level,label:q[a.level]+"告警",text:'<a data-href="'+o.createPath("fault-device",{id:a.id})+'">'+(r[a.code]||r[-1])+"</a>"}),J.renderData("",{items:b})}function j(){L||(L=new IXW.Lib.PopTrigger({id:"racks-pop",triggerMode:"mouseover",position:"right",ifKeepPanel:function(a,b){return console.log("keep:",a,b),b&&!!$XD.isAncestor(a,b)},bodyRefresh:function(a,b){M(a,b)}}))}function k(a,b){function c(a){var b=B;B=IX.map(a,function(a){var c=a.id;b=IX.Array.remove(b,c);var d=A.get(c);return d&&d.setLevel(a.level),c}),IX.iterate(b,function(a){var b=A.get(a);b&&b.clearLevel()})}function d(a){var b=a.id,c=new g(a);return A.register(b,c),a.level>0&&B.push(b),c}function e(b,c){var d=new h(b,c);z.register(b.id,d);var e=I.renderData("racks",d.getTpldata()),f=jQuery($X(a)).find(".addrack");jQuery(e).insertBefore(f)}function f(a){var b;z.getFirst().getId()==a&&(b=jQuery("#rack-"+a).next().attr("id")),z.remove(a),jQuery("#rack-"+a).remove(),jQuery("#"+b).css("margin-left","0")}function k(a){function b(b,c,d){var e=$XH.ancestor(b.target,"device");e&&($XH.hasClass(a,"editing")?c:d)(e)}IX.bind(a,{mouseover:function(a){b(a,function(a){$XH.addClass(a,"hover")},function(a){L.trigger(a)})},mouseout:function(a){b(a,function(a){$XH.removeClass(a,"hover")},IX.emptyFn)}})}function l(b){z.clear(),A.clear(),B=[];var c=$X(a);c&&(c.innerHTML=I.renderData("",{bgImg:TNM.Global.rackBackgroundImg,racks:[]}),k($XH.first(c,"racks"))),IX.iterate(b,function(a){e({id:a.id,name:a.name},IX.map(a.devices,d))})}function m(a,b,c){var d=jQuery(a).parents(".racks").find("."+b);d[c?"addClass":"removeClass"]("visible")}function n(a,b,c){var d=Math.max(0,b-D),e=Math.min(c,d);E=e,a.style.marginLeft=0-e*C+"px",m(a,"btn-prev",e>0),m(a,"btn-next",d>e)}function o(a,b,c){n(a,b,c),a.style.width=b*C+"px",$XH[b>D?"addClass":"removeClass"]($XH.ancestor(a,"racks"),"multi")}function p(a,b,c){var d=b-256;a.style.width=d+"px";var e=Math.floor((d+100)/(y+100)),f=Math.floor((d-y)/Math.max(1,e-1))-y;d>1e3&&1300>d&&(f=Math.max(85,Math.min(f,90))),d>1300&&(f=Math.max(70,Math.min(f,70))),900>d&&(f=Math.max(85,Math.min(f,180))),C=y+f,D=Math.floor((d+f)/C);var g=$XH.first(a,"view");o(g,c,E),jQuery(g).children("div").not(":first-child").css("margin-left",f+"px"),L.hide()}function q(b){var c=$XH.first($X(a),"racks");c&&b(c,c.offsetWidth,$XH.first(c,"area-c"))}function r(a,b){var c=a?$XH.hasClass(a,"editing"):b;return z.getSize()+(c?1:0)}function t(a){q(function(b,c,d){$XH[a?"addClass":"removeClass"](b,"editing"),a?(jQuery(".nv-checkbox").find(".ixpic-").css("display","inline-block"),jQuery(".addrack").css("display","inline-block")):(jQuery(".nv-checkbox").find(".ixpic-").css("display","none"),jQuery(".addrack").css("display","none")),p(d,c,r(null,a))})}function u(a){q(function(a,b,c){p(c,b,r(a))})}function v(a){q(function(b,c,d){a(d,r(b))})}var w=b,x=!1,z=new IX.IListManager,A=new IX.IListManager,B=[];M=function(a,b){var c=$XD.dataAttr(b,"key");s("getDeviceDetail",{siteId:w,deviceId:c},function(b){a.innerHTML=i(b)})},j();var C=0,D=0,E=0;return{resetSiteId:function(a){w=a,x=!1},getSiteId:function(){return w},getDevice:function(a){return A.get(a)},newDevice:function(a){var b=new g(a);return A.register(a.id,b),b},getRack:function(a){return z.get(a)},newRack:function(a){var b={siteId:w,name:"机柜"+z.getSize()};s("addRack",b,function(c){b.id=c.id,e({id:c.id,name:c.name},[]),u(!0),jQuery(".area-c").width()<1e3&&z.getSize()>=2&&(jQuery(".btn-next").append("<span class='click'>Click</span>"),jQuery(".click").click(),jQuery(".click").remove()),z.getSize()>2&&(jQuery(".btn-next").append("<span class='click'>Click</span>"),jQuery(".click").click(),jQuery(".click").remove());var d=$XH.first($XH.first($X("rack-"+c.id),"rack-title"),"name");a(d,c.id)})},removeRacks:function(a){IX.iterate(a,f),u(!1)},checkFaultStatus:function(a){s("getDeviceFaultStatus",{siteId:w},c,a)},refresh:function(a){return x?(t(a),A.iterate(function(a){a.refresh()})):void s("getRacks",{siteId:w},function(b){x=!0,l(b),t(a)})},resize:function(){v(function(a,b){p(a,a.parentNode.offsetWidth,b)})},slide:function(a){v(function(b,c){n($XH.first(b,"view"),c,E+a)})}}}function l(a,b){function c(b){a.previousSibling.children[1].innerHTML=IX.encodeTXT(b),jQuery(a.previousSibling.children[1]).attr("title",IX.encodeTXT(b)),$XH.removeClass(a.previousElementSibling,"hidden"),$XH.removeClass(a,"hidden"),f.innerHTML="",$XH.addClass(f,"hidden"),e.setName(b)}function d(a){return a==g?c(a):void s("editRack",{siteId:B.getSiteId(),id:b,name:a},function(){c(a)})}var e=B.getRack(b);if(e){var f,g=e.getName();$XH.addClass(a,"hidden"),a&&($XH.addClass(a.previousElementSibling,"hidden"),f=$XD.next(a,"span"),f.innerHTML="<input class='editName' type='text' maxlength='20'>");var h=$XD.first(f,"input");h&&(h.value=g),$XH.removeClass(f,"hidden"),IX.bind(h,{blur:function(){d(h.value.trim())},keydown:function(a){8==a.which&&IX.Util.Event.stopPropagation(a),13==a.which&&h.blur()}}),h&&h.focus()}}function m(a,b){var c=B.getRack($XD.dataAttr($XD.ancestor(a,"ul"),"key"));c&&b(c)}var n=IXW.Actions.configActions,o=IXW.Pages,p=NV.Dialog.alert,q=TNM.Const.FaultLevels,r=TNM.Const.FaultFormats,s=TNM.Global.sysCaller,t=TCM.Const.DeviceTypes,u=TCM.Const.DeviceTypeNames,v=["TNM","TVS","TAS","TVR","Storage","Coder","Decoder","Spliter","SpecialDecoder","HUB","PDH","FiberConvertor","KVM","PDU"],w=TNM.Const.MaxUnitInRack,x=TNM.Const.PXPerUnit,y=300,z=(a(0,w),null),A=TNM.Global.getRackDeviceImgUrl,B=null,C=NV.Dialog.show,D=NV.Dialog.hide,E=NV.Dialog.confirm,F=new IX.ITemplate({tpl:['<ul class="rack-device">','<li><span class="label">车站</span><span class="text">{siteName}</span></li>','<li><span class="label">机柜</span><span class="text">{rackName}</span></li>','<li><span class="label">选择设备</span>{deviceCombo}</li>','<li class="pos"><span class="label">机柜位置</span>{stxPosCombo}<span class="sepLine">－－</span>{endPosCombo}</li>',"</ul>",""]}),G=new IX.ITemplate({tpl:['<li id="board-{id}" class="board" style="top:{top}px;">','<a data-href="$rack.add" data-key="{idx}"></a>',"</li>",""]}),H=new IX.ITemplate({tpl:['<li id="device-{id}" class="device level{level} U{unit}" data-key="{id}" style="height:{height}px;top:{top}px;">','<a class="img" data-href="$rack.click" data-key="{id}"><img src="{img}"></a>','<div class="mask">','<a class="icon-edit" data-href="$rack.edit" data-key="{id}"></a>','<a class="icon-delete" data-href="$rack.delete" data-key="{id}"></a>',"</div>",'<a class="fault" data-href="$rack.fault" data-key="{id}" data-level="{level}">','<img class="max" src="{maxFaultImg}">','<img class="min" src="{minFaultImg}">',"</a>","</li>",""]}),I=new IX.ITemplate({tpl:['<img src="{bgImg}" />','<div class="racks">','<div class="area-l"><a data-href="$racks.prev" class="btn-prev"></a><span class="pic-"></span></div>','<div class="area-c"><div class="view">','<tpl id="racks">','<div id="rack-{id}" class="rack-area">','<div class="rack-title">','<a class="nv-checkbox" data-href="$racks.check" data-key="{id}"><span class="ixpic-"></span><span title="{name}">{name}</span></a>','<a data-href="$racks.edit", data-key="{id}"><span class="edit-rack"></span></a>','<span class="hidden"></span>',"</div>",'<div class="rack"><ul data-key="{id}">{html}</ul></div>',"</div>","</tpl>",'<div class="addrack"><a data-href="$racks.add" class="pic-"></a></div>',"</div></div>",'<div class="area-r"><a data-href="$racks.next" class="btn-next"></a><span class="pic-"></span></div>','<a data-href="$racks.delete" class="btn-delete disabled"></a>',"</div>",""]
}),J=new IX.ITemplate({tpl:['<ul class="rack-device">','<tpl id="items">','<li class="{clz}">','<span class="label">{label}</span>','<span class="text">{text}</span>',"</li>","</tpl>","</ul>",""]}),K={name:"设备名称",provider:"厂家",ip:"IP地址",style:"型号",desc:"备注"},L=null,M=IX.emptyFn;n([["rack.add",function(a,b){m(b,function(b){e({pos:a.key-0,size:1},B.getSiteId(),b)})}],["rack.edit",function(a,b){m(b,function(b){var c=B.getDevice(a.key);c&&e(c.getAttr(),B.getSiteId(),b)})}],["rack.delete",function(a,b){m(b,function(b){d({title:"从机柜中移出设备",info:"从当前机柜移出该设备",callerName:"removeDevice",params:{siteId:B.getSiteId(),rackId:b.getId(),deviceId:a.key}},function(){b.remove(a.key)})})}],["rack.click",function(a,b){L&&L.hide()}],["rack.fault",function(a,b){L&&L.hide();var c=jQuery("#site4Rack").attr("value");o.load(o.createPath("fault-device",{id:a.key,siteId:c}))}],["racks.check",function(a,b){var c=jQuery(b).parents(".racks");if(c.hasClass("editing")){$XH.toggleClass(b,"selected"),$XH.toggleClass(b.previousElementSibling,"selected");var d=c.find(".nv-checkbox.selected").length>0;c.find(".btn-delete")[d?"removeClass":"addClass"]("disabled")}}],["racks.add",function(a,b){B.newRack(function(a,b){l(a,b)})}],["racks.prev",function(a,b){B.slide(-1)}],["racks.next",function(a,b){B.slide(1)}],["racks.edit",function(a,b){var c=$XH.ancestor(b,"racks");$XH.hasClass(c,"editing")&&l(b,a.key)}],["racks.delete",function(a,b){if(!$XH.hasClass(b,"disabled")){var c=IX.map(jQuery(b).parents(".racks").find(".nv-checkbox.selected"),function(a){return $XD.dataAttr(a,"key")});d({title:"从当前单位移除机柜",info:"从当前单位移除选中的机柜",callerName:"removeRacks",params:{siteId:B.getSiteId(),ids:c}},function(){B.removeRacks(c),jQuery("div.editing").find("a.btn-delete").addClass("disabled")})}}]]),IX.ns("TNM.Lib"),TNM.Lib.RacksPanel=function(a,c){function d(){var b=$X(a);b&&IX.checkReady(function(){return!!z},function(){B.refresh(e)},500)}var e=!1;return z||b(),B=new k(a,c),{check:function(b){B&&!e&&$XH.first($X(a),"racks")&&B.checkFaultStatus(b)},resetMode:function(a){e="edit"==a,d()},resetSite:function(a){B.resetSiteId(a),d()},resize:function(){B.resize()},clear:function(){L&&L.hide()},refresh:d}}}(),function(){function a(a){function b(a,b,c){var d=q[b?"stations":"others"],e=b?j:i,f=Math.max(1,d.length),g=Math.max(0,Math.min(e,Math.floor(a/f)-e));IX.iterate(d,function(a,b){if(b>=f-1)return void(a.right=0);a.right=g;var d=c?$X("site-"+a.id):null;d&&(d.style.marginRight=g+"px")}),q[b?"botSW":"topSW"]=(e+g)*(f-1)}function c(a){var b=$X("body"),c=b.offsetHeight-45;a.style.height=c+"px";var d=$XH.first(a,"topo");d.style.height=c+"px";var e=$XH.hasClass($XH.first(d,"bottom"),"collapsed");q.top=Math.max(45,Math.floor(c/2)-(e?h:g)),d.style.top=q.top+"px",jQuery(".topo-bg").css({width:"1720px",height:"980px",background:"url("+TNM.Global.topoBackgroundImg+")"})}function m(a,c){var d=Math.max(k,a)-80;b(d,!1,c),b(d,!0,c)}function n(a){IX.iterate(a,function(a){var b=$XD.first($X("site-"+a.id),"a");if(b){var c=$XP(a,"level",0);$XD.setDataAttr(b,"value",c),b.className="level"+c}})}function o(a){q[a]=IX.Array.sort(q[a],function(a,b){return a.no-b.no})}function p(b){var e=TNM.Lib.verticalText(b);IX.iterate(e,function(a,c){var e=a.type==d.Station?"stations":"others";if(a.typeName=l[a.type],"others"==e){var f=[];f.name=b[c].name,q[e]?q[e].push(IX.inherit(a,f)):q[e]=[IX.inherit(a,f)]}else q[e]?q[e].push(a):q[e]=[a]}),o("others"),o("stations");var g=$X(a);g&&(m(g.offsetWidth,!1),g.innerHTML=f.renderData("",q),c(g))}var q={top:0};return{checkFaultStatus:function(a){e("getStatus4Sites",{},n,a)},refresh:function(){e("getAllSites",{},p)},resizeTop:function(){var b=$X(a);b&&c(b)},resize:function(){var b=$X(a);b&&(c(b),m(b.offsetWidth,!0))}}}var b=IXW.Actions.configActions,c=IXW.Pages,d=TCM.Const.SiteTypes,e=(TNM.Const.FaultLevels,TNM.Const.FaultFormats,TNM.Global.sysCaller),f=new IX.ITemplate({tpl:['<div class="topo-bg"></div>','<div class="topo" style="top:{top}px;">','<div class="top">',"<ul>",'<tpl id="others">','<li id="site-{id}" class="{typeName}" style="margin-right:{right}px;">','<a class="level{level}" data-href="$topo.click" data-key="{id}" data-value="{level}">','<span class="name">{name}</span><span class="ico-"></span>',"</a>",'<div class="line"></div>',"</li>","</tpl>","</ul>",'<div class="sp" style="width:{topSW}px;"></div>','<div class="line"></div>',"</div>",'<div class="middle">		','<div><span class="ico-cloud"></span></div>','<div class="line"></div>','<div><a data-href="$topo.expand">','<span class="ico-"></span><span class="name">全部车站</span>',"</a></div>","</div>",'<div class="bottom collapsed">','<div class="line"></div>','<div class="sp" style="width:{botSW}px;"></div>',"<ul>",'<tpl id="stations">','<li id="site-{id}" class="station" style="margin-right:{right}px;">','<div class="line"></div>','<a class="level{level}" data-href="$topo.click" data-key="{id}" data-value="{level}">','<span class="ico-"></span><span class="name">{name}</span>',"</a>","</li>","</tpl>","</ul>","</div>","</div>",""]}),g=340,h=240,i=80,j=32,k=1e3,l={0:"tcc",1:"occ",2:"depot",3:"station",4:"bocc",5:"police",6:"ptsd"},m=null;b([["topo.click",function(a,b){var d=$XD.dataAttr(b,"value")>0?"fault-site":"sys-rack";c.load(c.createPath(d,{id:a.key}))}],["topo.expand",function(a,b){var c=$XH.next($XH.ancestor(b,"middle"),"bottom");$XH.toggleClass(c,"collapsed"),m&&m.resizeTop()}]]),IX.ns("TNM.Lib"),TNM.Lib.TopoPanel=function(b){return m=new a(b),IX.inherit(m,{check:function(a){m&&$XH.first($X(b),"topo")&&m.checkFaultStatus(a)}})}}(),function(){var a=IX.CSSVendorName+"transform:scale({rate});";TNM.Lib.onresize=function(b,c,d){function e(){var c=$X(b);if(b){var e=document.documentElement[f],k=e>g?1:(Math.max(h,e)-i)/j;c.style.cssText=a.replaceByParams({rate:k}),IX.isFn()&&d()}}var f="width"==$XP(c,"which","width")?"clientWidth":"clientHeight",g=$XP(c,"max"),h=$XP(c,"min"),i=$XP(c,"fixed"),j=Math.max(1,g-i);e(),$Xw.bind({resize:e})},TNM.Lib.verticalText=function(a){var b=/([A-Z]|[0-9])+/g;return IX.loop(a,[],function(a,c,d){for(var e,f=[],g=null,h=0,i="index";e=b.exec(c.name);){0===e[i]&&(g=!0);var j=1==e[0].length?16:8*e[0].length;h+=j,f.push('<div class="vertical" style="width:'+j+"px; height:"+j+'px">'+e[0]+"</div>")}for(var k=c.name.replace(b,",").split(","),l=[],m=0;m<k.length;m++)k[m]&&(h+=16*k[m].length,l.push('<div style="height:'+16*k[m].length+'px">'+k[m]+"</div>"));if(0!==f.length){var n=[];if(g)for(var o=0;o<f.length;o++)n.push(f[o]),n.push(l[o]);else for(var p=0;p<l.length;p++)n.push(l[p]),n.push(f[p]);a.push(IX.inherit(c,{name:'<div class="ver-text" style="height:'+h+'px">'+n.join("")+"</div>"}))}else a.push(IX.inherit(c,{name:'<div class="ver-text" style="height:'+16*c.name.length+'px">'+c.name+"</div>"}));return a})},TNM.Lib.resizeTreeAndGrid=function(a){var b=jQuery(".sidebar").height();if(b>880){jQuery(".nvgrid-body").css("min-height",b-110+"px");var c=jQuery("#Grid").height();a.style.height=c+"px",jQuery(".nv-tree").css("height",c-60+"px")}else{jQuery(".nvgrid-body").css("min-height","786px");var d=jQuery(".nv-grid").height();a.style.height=d+"px",jQuery(".nv-tree").css("height",d-60+"px")}}}(),function(a,b,c){function d(c){var d=b.console;f[c]||(f[c]=!0,a.migrateWarnings.push(c),d&&d.warn&&!a.migrateMute&&a.migrateTrace&&d.trace)}function e(b,c,e,f){if(Object.defineProperty)try{return void Object.defineProperty(b,c,{configurable:!0,enumerable:!0,get:function(){return d(f),e},set:function(a){d(f),e=a}})}catch(g){}a._definePropertyBroken=!0,b[c]=e}var f={};a.migrateWarnings=[],!a.migrateMute&&b.console&&b.console.log,a.migrateTrace===c&&(a.migrateTrace=!0),a.migrateReset=function(){f={},a.migrateWarnings.length=0},"BackCompat"===document.compatMode&&d("jQuery is not compatible with Quirks Mode");var g=a("<input/>",{size:1}).attr("size")&&a.attrFn,h=a.attr,i=a.attrHooks.value&&a.attrHooks.value.get||function(){return null},j=a.attrHooks.value&&a.attrHooks.value.set||function(){return c},k=/^(?:input|button)$/i,l=/^[238]$/,m=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,n=/^(?:checked|selected)$/i;e(a,"attrFn",g||{},"jQuery.attrFn is deprecated"),
a.attr=function(b,e,f,i){var j=e.toLowerCase(),o=b&&b.nodeType;return i&&(h.length<4&&d("jQuery.fn.attr( props, pass ) is deprecated"),b&&!l.test(o)&&(g?e in g:a.isFunction(a.fn[e])))?a(b)[e](f):("type"===e&&f!==c&&k.test(b.nodeName)&&b.parentNode&&d("Can't change the 'type' of an input or button in IE 6/7/8"),!a.attrHooks[j]&&m.test(j)&&(a.attrHooks[j]={get:function(b,d){var e,f=a.prop(b,d);return f===!0||"boolean"!=typeof f&&(e=b.getAttributeNode(d))&&e.nodeValue!==!1?d.toLowerCase():c},set:function(b,c,d){var e;return c===!1?a.removeAttr(b,d):(e=a.propFix[d]||d,e in b&&(b[e]=!0),b.setAttribute(d,d.toLowerCase())),d}},n.test(j)&&d("jQuery.fn.attr('"+j+"') may use property instead of attribute")),h.call(a,b,e,f))},a.attrHooks.value={get:function(a,b){var c=(a.nodeName||"").toLowerCase();return"button"===c?i.apply(this,arguments):("input"!==c&&"option"!==c&&d("jQuery.fn.attr('value') no longer gets properties"),b in a?a.value:null)},set:function(a,b){var c=(a.nodeName||"").toLowerCase();return"button"===c?j.apply(this,arguments):("input"!==c&&"option"!==c&&d("jQuery.fn.attr('value', val) no longer sets properties"),void(a.value=b))}};var o,p,q=a.fn.init,r=a.parseJSON,s=/^([^<]*)(<[\w\W]+>)([^>]*)$/;a.fn.init=function(b,c,e){var f;return b&&"string"==typeof b&&!a.isPlainObject(c)&&(f=s.exec(a.trim(b)))&&f[0]&&("<"!==b.charAt(0)&&d("$(html) HTML strings must start with '<' character"),f[3]&&d("$(html) HTML text after last tag is ignored"),"#"===f[0].charAt(0)&&(d("HTML string cannot start with a '#' character"),a.error("JQMIGRATE: Invalid selector string (XSS)")),c&&c.context&&(c=c.context),a.parseHTML)?q.call(this,a.parseHTML(f[2],c,!0),c,e):q.apply(this,arguments)},a.fn.init.prototype=a.fn,a.parseJSON=function(a){return a||null===a?r.apply(this,arguments):(d("jQuery.parseJSON requires a valid JSON string"),null)},a.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a.browser||(o=a.uaMatch(navigator.userAgent),p={},o.browser&&(p[o.browser]=!0,p.version=o.version),p.chrome?p.webkit=!0:p.webkit&&(p.safari=!0),a.browser=p),e(a,"browser",a.browser,"jQuery.browser is deprecated"),a.sub=function(){function b(a,c){return new b.fn.init(a,c)}a.extend(!0,b,this),b.superclass=this,b.fn=b.prototype=this(),b.fn.constructor=b,b.sub=this.sub,b.fn.init=function(d,e){return e&&e instanceof a&&!(e instanceof b)&&(e=b(e)),a.fn.init.call(this,d,e,c)},b.fn.init.prototype=b.fn;var c=b(document);return d("jQuery.sub() is deprecated"),b},a.ajaxSetup({converters:{"text json":a.parseJSON}});var t=a.fn.data;a.fn.data=function(b){var e,f,g=this[0];return!g||"events"!==b||1!==arguments.length||(e=a.data(g,b),f=a._data(g,b),e!==c&&e!==f||f===c)?t.apply(this,arguments):(d("Use of jQuery.fn.data('events') is deprecated"),f)};var u=/\/(java|ecma)script/i,v=a.fn.andSelf||a.fn.addBack;a.fn.andSelf=function(){return d("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),v.apply(this,arguments)},a.clean||(a.clean=function(b,c,e,f){c=c||document,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,d("jQuery.clean() is deprecated");var g,h,i,j,k=[];if(a.merge(k,a.buildFragment(b,c).childNodes),e)for(i=function(a){return!a.type||u.test(a.type)?f?f.push(a.parentNode?a.parentNode.removeChild(a):a):e.appendChild(a):void 0},g=0;null!==(h=k[g]);g++)a.nodeName(h,"script")&&i(h)||(e.appendChild(h),"undefined"!=typeof h.getElementsByTagName&&(j=a.grep(a.merge([],h.getElementsByTagName("script")),i),k.splice.apply(k,[g+1,0].concat(j)),g+=j.length));return k});var w=a.event.add,x=a.event.remove,y=a.event.trigger,z=a.fn.toggle,A=a.fn.live,B=a.fn.die,C="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",D=new RegExp("\\b(?:"+C+")\\b"),E=/(?:^|\s)hover(\.\S+|)\b/,F=function(b){return"string"!=typeof b||a.event.special.hover?b:(E.test(b)&&d("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),b&&b.replace(E,"mouseenter$1 mouseleave$1"))};a.event.props&&"attrChange"!==a.event.props[0]&&a.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),a.event.dispatch&&e(a.event,"handle",a.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),a.event.add=function(a,b,c,e,f){a!==document&&D.test(b)&&d("AJAX events should be attached to document: "+b),w.call(this,a,F(b||""),c,e,f)},a.event.remove=function(a,b,c,d,e){x.call(this,a,F(b)||"",c,d,e)},a.fn.error=function(){var a=Array.prototype.slice.call(arguments,0);return d("jQuery.fn.error() is deprecated"),a.splice(0,0,"error"),arguments.length?this.bind.apply(this,a):(this.triggerHandler.apply(this,a),this)},a.fn.toggle=function(b,c){if(!a.isFunction(b)||!a.isFunction(c))return z.apply(this,arguments);d("jQuery.fn.toggle(handler, handler...) is deprecated");var e=arguments,f=b.guid||a.guid++,g=0,h=function(c){var d=(a._data(this,"lastToggle"+b.guid)||0)%g;return a._data(this,"lastToggle"+b.guid,d+1),c.preventDefault(),e[d].apply(this,arguments)||!1};for(h.guid=f;g<e.length;)e[g++].guid=f;return this.click(h)},a.fn.live=function(b,c,e){return d("jQuery.fn.live() is deprecated"),A?A.apply(this,arguments):(a(this.context).on(b,this.selector,c,e),this)},a.fn.die=function(b,c){return d("jQuery.fn.die() is deprecated"),B?B.apply(this,arguments):(a(this.context).off(b,this.selector||"**",c),this)},a.event.trigger=function(a,b,c,e){return c||D.test(a)||d("Global events are undocumented and deprecated"),y.call(this,a,b,c||document,e)},a.each(C.split("|"),function(b,c){a.event.special[c]={setup:function(){var b=this;return b!==document&&(a.event.add(document,c+"."+a.guid,function(){a.event.trigger(c,null,b,!0)}),a._data(this,c,a.guid++)),!1},teardown:function(){return this!==document&&a.event.remove(document,c+"."+a._data(this,c)),!1}}})}(jQuery,window),function(a){var b;a.fn.jqprint=function(c){b=a.extend({},a.fn.jqprint.defaults,c);var d=this instanceof jQuery?this:a(this),e=null,f=null,g=null;b.operaSupport&&a.browser.opera?(f=window.open("","jqPrint-preview"),f.document.open(),e=f.document):(g=a("<iframe  />"),b.debug||g.css({position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"}),g.appendTo("body"),e=g[0].contentWindow.document),b.importCSS&&(a("link[media=print]").length>0?a("link[media=print]").each(function(){e.write("<link type='text/css' rel='stylesheet' href='"+a(this).attr("href")+"' media='print' />")}):a("link").each(function(){e.write("<link type='text/css' rel='stylesheet' href='"+a(this).attr("href")+"' />")})),b.printContainer?e.write(d.outer()):d.each(function(){e.write(a(this).html())}),e.close(),(b.operaSupport&&a.browser.opera?f:g[0].contentWindow).focus(),setTimeout(function(){(b.operaSupport&&a.browser.opera?f:g[0].contentWindow).print(),f&&f.close()},1e3)},a.fn.jqprint.defaults={debug:!1,importCSS:!0,printContainer:!0,operaSupport:!0},jQuery.fn.outer=function(){return a(a("<div></div>").html(this.clone())).html()}}(jQuery),function(){function a(a,c,d,e){var f=new b(a,c,d,e),g=f.getTpldata();return g.clz=a.enabled?"":"disabled",f.getTpldata=function(){return g},f}var b=IXW.Lib.GridModel.RowModelBase;IX.ns("TCM.Lib");var c={refresh:!1,create:!1,add:!1,"delete":!0};TCM.Lib.Grid=function(b,d){function e(){i(function(a){h.addItems(a.ids)})}function f(a){j(a,function(){h.removeItems(IX.map(a,function(a){return a.getId()}))})}function g(a){f([a])}var h=null,i=$XF(d,"listen.createItem"),j=$XF(d,"listen.deleteItems");return h=new NV.Lib.Grid(IX.inherit(d.grid,{container:b,title:$XP(d,"title",""),rowModel:$XP(d,"rowModel",a),actions:IX.loop($XP(d,"grid.actions",[]),[],function(a,b){return IX.isString(b)?("delete"==b&&a.push(["delete","删除",g]),a):(b.length<=2&&"delete"==b[0]&&(b[2]=g),a.push(b),a)}),tools:{buttons:IX.map($XP(d,"tools.buttons",[]),function(a){return{name:a,chkEnabled:c[a]}}),actions:IX.inherit({refresh:function(){h.refresh()},create:e,add:e,"delete":function(){f(h.getSelectedRows())}},$XP(d,"tools.actions"))}})),h.show(),h}}(),function(){function a(){if("entry"==c.getCurrentName()){var a=window.innerWidth,b=window.innerHeight,d=(document.body.clientWidth,
Math.max(a/e,b/f)),h=jQuery(".bg img");h.css({width:Math.round(e*d)+"px",height:Math.round(f*d)+"px"}),jQuery(".container").css("bottom",Math.max(0,Math.round((b-g)/2))+"px")}}var b=new IX.ITemplate({tpl:['<div class="bg"><img src="{background}"></div>','<div class="container">','<div class="pic_top">','<div class="pic_squre"></div>','<div class="pic_char"></div>',"</div>","<ul>",'<li><span class="pic-user"></span><span class="verLine"></span><input type="text" id="account" tabindex="1" placeholder="账号"></li>','<li><span class="pic-pwd"></span><span class="verLine"></span><input type="password" id="password" tabindex="2" placeholder="密码"></li>',"</ul>",'<a id="submit" tabindex="3" class="btn longbtn" data-href="$login"><span>立即</span><span>登录</span></a>',"</div>",'<div class="footer" id="footer"><span class="footer-bar"></span></div>',""]}),c=IXW.Pages,d=NV.Dialog.alert;IXW.Actions.configActions([["login",function(){jQuery("#submit").attr("disabled",!0),jQuery("#account").attr("disabled",!0),jQuery("#password").attr("disabled",!0);var a=$X("account").value,b=$X("password").value;return a.isWindowsDirectory()&&b.isWindowsDirectory()?void TNM.Global.entryCaller("login",{username:a,password:b},function(a){jQuery("#submit").attr("disabled",!1),jQuery("#account").attr("disabled",!1),jQuery("#password").attr("disabled",!1),TNM.Env.resetSession(a),c.load("")},function(a){d(a.err?a.err:"网络中断，请检查网络或者服务器是否正常！"),jQuery("#submit").attr("disabled",!1),jQuery("#account").attr("disabled",!1),jQuery("#password").attr("disabled",!1),$X("account").blur(),$X("password").blur()}):(jQuery("#submit").attr("disabled",!1),jQuery("#account").attr("disabled",!1),jQuery("#password").attr("disabled",!1),NV.Dialog.alert('账号密码中请勿包含\\/^:*><|@?"特殊字符！'))}]]);var e=1939,f=1175,g=300;$Xw.bind({resize:a}),IX.ns("TNM.Entry"),TNM.Entry.init=function(d,e,f){if(TNM.Env.hasSession())return c.load("");document.body.innerHTML=b.renderData("",{background:TNM.Global.backgroundUrl}),a(),jQuery("input").bind({focus:function(a){$XH.addClass($XD.ancestor(this,"li"),"focus")},blur:function(a){$XH.removeClass($XD.ancestor(this,"li"),"focus")}}),$X("account").focus();var g=$X("submit");jQuery("#account").bind("keydown",function(a){13==a.which&&$X("$password").focus()}),jQuery("#password").keydown(function(a){13==a.keyCode&&(g.click(),$X("account").blur(),$X("password").blur())})}}(),function(){IX.ns("TNM.ErrPage"),TNM.ErrPage.init=function(a,b,c){document.body.innerHTML="ERROR"}}(),function(){function a(){return h&&$XH.hasClass(document.body,h)}function b(a,b){k.stop(),h=a,j=b.resize,i=b.check,k.start()}function c(a){$X("body").innerHTML=l.renderData("",{});var c=new TNM.Lib.SitesPanel("container");jQuery("#container").css({backgroundImage:"url("+TNM.Global.lineBackgroundUrl+")"}),c.refresh(),b("sys-line",c)}function d(a,c){var d=TCM.LineInfo.getSites(),e=IX.map(d.getAll(),function(a){return{id:a.id,name:a.name,action:"sys.rack.pick"}}),f=d.get(a||TNM.Env.getSession().getSiteId());$X("body").innerHTML=m.renderData("",{focused:"editing",html:NV.Lib.getComboHTML("site4Rack",{value:f.id,valueText:f.name,items:e})}),document.documentMode||jQuery("body").addClass("isNotIE"),n=new TNM.Lib.RacksPanel("container",f.id),n.refresh(),b("sys-rack",n)}function e(a){$X("body").innerHTML=o.renderData("",{});var c=new TNM.Lib.TopoPanel("container");c.refresh(),b("sys-topo",c)}function f(a,b){var c=a.name;jQuery("#container").remove(),"sys-rack"==c&&n.clear()}var g=IXW.Actions.configActions,h=null,i=IX.emptyFn,j=IX.emptyFn,k=new TNM.Util.PeriodicChecker(a,function(a){i(a)});$Xw.bind({resize:function(){a()&&j()}});var l=new IX.ITemplate({tpl:['<div class="nv-title">线路图</div>','<div id="container"></div>',""]}),m=new IX.ITemplate({tpl:['<div class="nv-box">','<div class="nv-title">','<div class="tabs">','<a class="focused" data-href="$sys.rack.switch" data-key="view"><span>查看机柜</span></a>','<a data-href="$sys.rack.switch" data-key="edit"><span>编辑机柜</span></a>',"</div>{html}","</div>",'<div id="container"></div>',"</div>	",""]}),n=null;g([["sys.rack.switch",function(a,b){n&&!$XH.hasClass(b,"focused")&&(n.resetMode(a.key),$XH.removeClass($XH.first(b.parentNode,"focused"),"focused"),$XH.addClass(b,"focused"))}],["sys.rack.pick",function(a,b){var c=a.key,d=b.innerHTML,e=$XH.ancestor(b,"dropdown");if(e){var f=$XD.first(e,"input");if(f.value!=c){f.value=c;var g=$XH.first($XH.first(e,"dropdown-toggle"),"name");g.innerHTML=d,n&&n.resetSite(c)}}}]]);var o=new IX.ITemplate({tpl:['<div class="nv-box">','<div class="nv-title">拓扑结构</div>','<div id="container"></div>',"</div>	",""]});IX.ns("TNM.Sys"),TNM.Sys.init=function(a,b,g){switch(a.switchOut=f,a.name){case"sys-line":c(g);break;case"sys-rack":d(b.id,g);break;case"sys-topo":e(g)}}}(),function(){function a(a){return a.isIP()}function b(a){if(isNaN(a))return!1;var b=a-0;return 0>b||b>65535||b!==parseInt(b)?!1:a}function c(c,d,e){return"loginIp"!=e||a(c)?"loginPort"!=e||b(c)?!0:(j("请输入正确的端口号，端口号范围：0~65535"),!1):(j("请输入正确的IP地址，例如：192.168.0.1"),!1)}function d(a,b,d){for(var e={},f=!1,g=0;g<b.length;g++){var h=b[g],i=null;if("device_bc"!=h.key){if(i=$X(h.key).value,!c(i,h.empty,h.name))return!1;f=f||!(a&&a.get(h.name)==i),IX.setProperty(e,h.name,i)}}if(e.type==k.Coder){e.channelNum=e.channelNum-0;for(var l=[],m=0;m<e.channelNum;m++){var n=$X("device_bcAddr"+(m+1)).value,o=$X("device_bcPort"+(m+1)).value;l.push({addr:n,port:o-0,channelNo:m+1})}e.bc=l}return f?(e.id=a.getId(),1===d.length&&(e.type=d[0]),e):(j("您未作任何修改，请点击取消关闭编辑窗口！"),!1)}function e(a,b,c,e,f){function j(){var h=d(a,k,e);h.siteId=f;var j=$XP(b,"checkInfo");!h||IX.isFn(j)&&!j(h)||g(b.callerName,h,function(a){i(),c({ids:[0===h.id?h.id:h.id||a.id]})})}for(var k=b.checkers,l={},m=0;m<k.length;m++){var n=k[m];l[n.key]=a&&a.get(n.name)?a.get(n.name).toString().dehtml():"","device_bc"==n.key&&(l[n.key]=a?a.get(n.name):"")}h({clz:b.clz,title:b.title,content:b.tpl.renderData("",b.tpldataFn(a,l)),listen:{ok:j}})}function f(a,b){return"<span><input disabled id='"+a+"' value='"+l[b]+"'></span>"}var g=TNM.Global.deviceCaller,h=(IXW.Actions.configActions,NV.Dialog.show),i=NV.Dialog.hide,j=(NV.Dialog.confirm,NV.Dialog.alert),k=TCM.Const.DeviceTypes,l=TCM.Const.DeviceTypeNames,m=(NV.Lib.getComboHTML,TCM.DeviceType.getNodeName),n=new IX.ITemplate({tpl:['<ul class="{clz}">','<li><span class="label">设备名称</span>','<span><input class="readOnly" disabled="disabled" maxlength="30" id="device_name" value="{device_name}"></span></li>','<li><span class="label">类型</span>{deviceTypeCombo}</li>','<li><span class="label">厂家</span>','<span><input class="readOnly" disabled="disabled" maxlength="30" id="device_provider" value="{device_provider}"></span></li>','<li><span class="label">型号</span>','<span><input class="readOnly" disabled="disabled" maxlength="30" id="device_style" value="{device_style}"></span></li>','<li><span class="label">软件名称或网页地址</span>','<span><input class="readOnly" disabled="disabled" maxlength="64" id="device_path" value="{device_path}"></span></li>','<li class="pdu"><span class="label">用户名</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_username" value="{device_username}"></span></li>','<li class="pdu"><span class="label">密码</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_password" value="{device_password}"></span></li>','<li><span class="label">备注</span>','<span><input class="readOnly" disabled="disabled" maxlength="150" id="device_desc" value="{device_desc}"></span></li>','<li><span class="label">登录方式</span>','<span><input class="loginIp" maxlength="15" id="device_loginIp" placeholder="IP" value="{device_loginIp}">','<input class="loginPort" maxlength="5" id="device_loginPort" placeholder="PORT"  value="{device_loginPort}"></span></li>',"</ul>",""]}),o=new IX.ITemplate({tpl:['<ul class="{clz}">','<li><span class="label">名称</span>','<span><input class="readOnly" disabled="disabled" maxlength="64" id="device_name" value="{device_name}"></span></li>','<li><span class="label">IP地址</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_ip" value="{device_ip}"></span></li>','<li><span class="label">用户名</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_username" value="{device_username}"></span></li>','<li><span class="label">密码</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_password" value="{device_password}"></span></li>','<li><span class="label">备注</span>','<span><input class="readOnly" disabled="disabled" id="device_desc" value="{device_desc}"></span></li>','<li><span class="label">登录方式</span>','<span><input class="loginIp" maxlength="15" id="device_loginIp" placeholder="IP" value="{device_loginIp}">','<input class="loginPort" maxlength="5" id="device_loginPort" placeholder="PORT" value="{device_loginPort}"></span></li>',"</ul>",""]
}),p=new IX.ITemplate({tpl:['<ul class="{clz}">','<li><span class="label">名称</span>','<span><input class="readOnly" disabled="disabled" maxlength="64" id="device_name" value="{device_name}"></span></li>','<li><span class="label">IP地址</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_ip" value="{device_ip}"></span></li>','<li><span class="label">用户名</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_username" value="{device_username}"></span></li>','<li><span class="label">密码</span>','<span><input class="readOnly" disabled="disabled" maxlength="15" id="device_password" value="{device_password}"></span></li>','<li><span class="label">备注</span>','<span><input class="readOnly" disabled="disabled" id="device_desc" value="{device_desc}"></span></li>','<li><span class="label">登录方式</span>','<span><input class="loginIp" maxlength="15" id="device_loginIp" placeholder="IP" value="{device_loginIp}">','<input class="loginPort" maxlength="5" id="device_loginPort" placeholder="PORT" value="{device_loginPort}"></span></li>',"</ul>",""]}),q=new IX.ITemplate({tpl:['<ul class="{clz}">','<li><span class="label">设备名称</span>','<span><input class="readOnly" disabled="disabled" id="device_name" value="{device_name}"></span>','<span class="label labelTwo">用户名</span>','<span><input class="readOnly" disabled="disabled" id="device_username" value="{device_username}"></span></li>','<li><span class="label">IP地址</span>','<span><input class="readOnly" disabled="disabled" id="device_ip" value="{device_ip}"></span>','<span class="label labelTwo">密码</span>','<span><input class="readOnly" disabled="disabled" id="device_password" value="{device_password}"></span></li>','<li><span class="label">端口号</span>','<span><input class="readOnly" disabled="disabled" id="device_port" value="{device_port}"></span>','<span class="label labelTwo">摄像机类型</span>{camerasTypeCombo}</li>','<li><span class="label">组播流地址</span>','<span><input class="readOnly" disabled="disabled" id="device_bcAddr" value="{device_bcAddr}"></span>','<span class="label labelTwo">厂家</span>','<span><input class="readOnly" disabled="disabled" id="device_provider" value="{device_provider}"></span></li>','<li><span class="label">组播流端口</span>','<span><input class="readOnly" disabled="disabled" id="device_bcPort" value="{device_bcPort}"></span>','<span class="label labelTwo">型号</span>','<span><input class="readOnly" disabled="disabled" id="device_style" value="{device_style}"></span></li>','<li><span class="label">通道数</span>','<span><input class="readOnly" disabled="disabled" id="device_channelNum" value="{device_channelNum}"></span>','<span class="label labelTwo">所属分区</span>','<span><input class="readOnly" disabled="disabled" id="device_zoneName" value="{device_zoneName}"></span></li>','<li><span class="label">备注</span>','<span><input class="readOnly" disabled="disabled" id="device_desc" value="{device_desc}"></span>','<span class="label labelTwo">登录方式</span>','<span><input class="loginIp" maxlength="15" id="device_loginIp" placeholder="IP" value="{device_loginIp}">','<input class="loginPort" maxlength="5" id="device_loginPort" placeholder="PORT" value="{device_loginPort}"></span></li>',"</ul>",""]}),r=new IX.ITemplate({tpl:['<ul class="{clz} main">','<li><span class="label">设备名称</span>','<span><input class="readOnly" disabled="disabled" id="device_name" value="{device_name}"></span>','<span class="label labelTwo">用户名</span>','<span><input class="readOnly" disabled="disabled" id="device_username" value="{device_username}"></span></li>','<li><span class="label">IP地址</span>','<span><input class="readOnly" disabled="disabled" id="device_ip" value="{device_ip}"></span>','<span class="label labelTwo">密码</span>','<span><input class="readOnly" disabled="disabled" id="device_password" value="{device_password}"></span></li>','<li><span class="label">端口号</span>','<span><input class="readOnly" disabled="disabled" id="device_port" value="{device_port}"></span>','<span class="label labelTwo">备注</span>','<span><input class="readOnly" disabled="disabled" id="device_desc" value="{device_desc}"></span></li>','<li><span class="label ">通道数</span>','<span><input class="readOnly" disabled="disabled" id="device_channelNum" value="{device_channelNum}"></span>','<span class="label labelTwo">登录方式</span>','<span><input class="loginIp" maxlength="15" id="device_loginIp" placeholder="IP" value="{device_loginIp}">','<input class="loginPort" maxlength="5" id="device_loginPort" placeholder="PORT" value="{device_loginPort}"></span>',"</li>",'<input id="device_type" value="{device_type}" style="display: none;">',"</ul>",""]}),s=[{name:"name",key:"device_name",empty:"设备名称"},{name:"desc",key:"device_desc",empty:""},{name:"username",key:"device_username",empty:""},{name:"password",key:"device_password",empty:""},{name:"loginIp",key:"device_loginIp",empty:""},{name:"loginPort",key:"device_loginPort",empty:""}],t={decoder:{clz:"decoder-edit",tpl:o,checkers:s.concat([{name:"ip",key:"device_ip",empty:"设备IP"}])},specialDecoder:{clz:"decoder-edit",tpl:p,checkers:s.concat([{name:"ip",key:"device_ip",empty:"设备IP"}])},other:{clz:"other-edit",tpl:n,checkers:s.concat([{name:"provider",key:"device_provider",empty:"设备厂家"},{name:"style",key:"device_style",empty:"设备型号"},{name:"type",key:"device_type",empty:""},{name:"path",key:"device_path",empty:"软件名称或网页地址"}])},coder:{clz:"coder-edit",tpl:r,checkers:s.concat([{name:"ip",key:"device_ip",empty:"设备IP"},{name:"port",key:"device_port",empty:""},{name:"channelNum",key:"device_channelNum",empty:""},{name:"bc",key:"device_bc",empty:""}])},IPC:{clz:"IPC-edit",tpl:q,checkers:s.concat([{name:"provider",key:"device_provider",empty:"设备厂家"},{name:"style",key:"device_style",empty:"设备型号"},{name:"ip",key:"device_ip",empty:"设备IP"},{name:"bcAddr",key:"device_bcAddr",empty:"组播流地址"},{name:"bcPort",key:"device_bcPort",empty:"组播流端口"},{name:"channelNum",key:"device_channelNum",empty:""},{name:"port",key:"device_port",empty:"端口号"},{name:"type",key:"camera_type",empty:""},{name:"zoneName",key:"device_zoneName",empty:""}])}};IX.ns("TNM.DeviceDialog"),TNM.DeviceDialog.editDevice=function(a,b,c){var d=[a.get("type")],g=m(d[0]);e(a,IX.inherit(t[g],{title:"编辑设备",callerName:"editDevice",tpldataFn:function(a,b){return b.clz=64==b.device_type?"PDU-edit":"edit",b.deviceTypeCombo=f("device_type",b.device_type||d[0]),b.camerasTypeCombo=f("camera_type",b.camera_type),IX.Array.isFound(d[0],[20,21,22])&&(b.clz="IPC-edit"),b.channels=b.device_bc?b.device_bc:[{addr:"",port:"",channelNo:1}],b.device_username=b.device_username||"admin",b.device_password=b.device_password||"admin",b}}),b,d,c)},TNM.DeviceDialog.logIn=function(a,b){console.log("logIn")}}(),function(){function a(a){return IX.map(a,function(a,b){return{name:j[a],key:[a]}})}function b(a){var b=IX.map(a.keys.split(","),function(a){return Number(a)}),c=b.join("-");e(o[c],{types:b,siteId:a.siteId-0,name:a.name+"列表",el:a.el})}function c(){jQuery(".nv-tree>ul>li>ul>li").children("ul").hide(),jQuery(".nv-tree>ul>li").children("ul").hide(),jQuery(".nv-tree>ul>li>a span.count").hide()}function d(a,b,c,d){var e=new IXW.Lib.GridModel.RowModelBase(a,b,c,d);return IX.inherit(e,{getTpldata:function(){var a=e.get("type"),b=e.getTpldata();return b.clz=IX.Array.isFound(a,[20,21,22,50,51,64])?"":"notLogin",b}})}function e(a,b){function c(a,b){if(a.get("loginIp")){var c="http://"+a.get("loginIp")+(a.get("loginPort")?":"+a.get("loginPort"):"");window.open(c)}else k("无可登录地址！")}function e(a,b){TNM.DeviceDialog.editDevice(a,function(){f.refresh()},h)}var f=null,g=$XP(a,"columns").split(","),h=(b.types,b.siteId);return f=new TCM.Lib.Grid($XP(a,"container","Grid"),{title:"设备管理",rowModel:d,grid:{clz:"device-list-"+b.types[0],columns:g,actions:[["edit","编辑",e],["login","登录",c]],hasCheckbox:$XP(a,"hasCheckbox")||!0,usePagination:$XP(a,"usePagination")||!0,dataLoader:function(a,c){i("getDevices4Type",IX.inherit(a,{types:b.types,siteId:b.siteId}),function(a){c(a),$X("Tree")&&TNM.Lib.resizeTreeAndGrid($X("Tree"))})}},tools:{buttons:[]},listen:{}})}function f(a,b,c){function d(a){return IX.map(a,function(a){return IX.inherit(a,e(a))})}function e(a){if(a.key)return{key:a.key,
count:b[a.key[0]]?b[a.key[0]]:0,siteId:c,nodes:[]};for(var e=[],f=0,g=0===a.nodes?[]:d(a.nodes),h=0;h<g.length;h++)e=e.concat(g[h].key),f+=g[h].count;return{key:e,count:f,siteId:c,nodes:g}}return d(a).pop()}function g(a){i("getAllDevices",{},function(b){var c=IX.map(b,function(a,b){var c={};IX.iterate(a.devices,function(a){c[a.type]=a.count});var d=TCM.LineInfo.getSites().get(a.siteId),e=[];return 1==d.type?e=[IX.inherit(n,{name:d.name})]:(m[0].name=d.name,e=m),f(e,c,a.siteId)});a({nodes:c})})}function h(a){g(function(a){var d=IX.inherit(a,{htmlFn:function(a){return a.name+'<span class="count">('+a.count+")</span>"},click:b}),e=new TCM.Lib.Tree(d);$X("body").innerHTML=p.renderData("",{treeName:"线路设备列表",treeData:e.getHTML(),clz:"device"}),c(),jQuery(".nv-tree li:first a:first span.count").click()}),a()}var i=TNM.Global.deviceCaller,j=(IXW.Actions.configActions,TCM.Const.DeviceTypeNames),k=NV.Dialog.alert,l=null,m=[{name:"",nodes:[{name:"数字摄像机",nodes:a([20,21,22])},a([50])[0],a([55])[0],{name:"网络和附属设备",nodes:a([64])}]}],n={name:"",nodes:[a([55])[0],{name:"网络和附属设备",nodes:a([64])}]},o={"55-64":{columns:"devName,devType,devUserName,devPassWord"},"20-21-22-50-55-64":{columns:"devName,devType,devUserName,devPassWord"},"20-21-22":{columns:"devName,devType,devIp,devUserName,devPassWord"},20:{columns:"devName,devType,devIp,devUserName,devPassWord"},21:{columns:"devName,devType,devIp,devUserName,devPassWord"},22:{columns:"devName,devType,devIp,devUserName,devPassWord"},50:{columns:"devName,devIp,devUserName,devPassWord"},51:{columns:"devName,devIp,devUserName,devPassWord"},55:{columns:"devName,devIp,devUserName,devPassWord"},64:{columns:"devName,devPath,devUserName,devPassWord"}},p=(new IX.ITemplate({tpl:['<div><input class="search" placeholder="设备选择"><a class="pic-search"></a></div>',""]}),new IX.ITemplate({tpl:['<div id="Tree"><div id="treeName">{treeName}</div>{treeData}</div>','<div id="Grid" class="{clz} nv-box"></div>',""]}));IX.ns("TNM.Device"),TNM.Device.init=function(a,b,c){l=TNM.Env.getSession().getLineInfo(),h(c)}}(),function(){function a(a){return IX.map(a,function(a,b){return{name:k[a],key:[a]}})}function b(a){var b=IX.map(a.keys.split(","),function(a){return Number(a)});d(o,{types:b,siteId:a.siteId-0,name:a.name+"列表",el:a.el,level:"all",isHandled:"all",from:TNM.Lib.GetCurDay().from,to:TNM.Lib.GetCurDay().to})}function c(a,b,c){var d={hasDate:!0,defaultDate:"",dataText:"告警时间",toolList:[{id:"level",text:"告警级别"},{id:"isHandled",text:"处理状态"}]};return new TNM.Lib.BaseFilterTools(IX.inherit(d,{defaultDate:a},{toolList:IX.map(d.toolList,function(a,d){return 0===d&&c?IX.inherit(a,{num:c}):1===d&&b?IX.inherit(a,{num:b}):a})}))}function d(a,b){var d,e=null,f=$XP(a,"columns").split(","),g=(b.types,b.fromSite),h=b.fromItem,j=(b.siteId,b.fromDevice);j?b.deviceId:"";return d=g||j?c("",2):h?c(b.faultDate,2,b.level):c("default"),e=new TNM.Lib.FilterGrid({container:$XP(a,"container","Grid"),title:"故障管理",clz:"device-list-"+b.types[0],columns:f,actions:[],tools:d,usePagination:$XP(a,"usePagination")||!0,baseParams:b,dataLoader:function(a,b){i(j?"getFault4Device":h?"getFaultById":"getFault4type",a,function(a){b(a),h=!1,g=!1,j=!1,$X("Tree")&&TNM.Lib.resizeTreeAndGrid($X("Tree"))})}})}function e(a,b,c){function d(a){return IX.map(a,function(a){return IX.inherit(a,e(a))})}function e(a){if(a.key)return{key:a.key,count:b[a.key[0]]?b[a.key[0]]:0,siteId:c,nodes:[]};for(var e=[],f=0,g=0===a.nodes?[]:d(a.nodes),h=0;h<g.length;h++)e=e.concat(g[h].key),f+=g[h].count;return{key:e,count:f,siteId:c,nodes:g}}return d(a).pop()}function f(a){i("getAllDevices",{},function(b){var c=IX.map(b,function(a,b){var c={};IX.iterate(a.devices,function(a){c[a.type]=a.count});var d=TCM.LineInfo.getSites().get(a.siteId),f=[];return 1==d.type?f=[IX.inherit(n,{name:d.name})]:(m[0].name=d.name,f=m),e(f,c,a.siteId)});a({nodes:c})})}function g(){jQuery(".nv-tree>ul>li>ul>li").children("ul").hide(),jQuery(".nv-tree>ul>li").children("ul").hide()}function h(a,c){f(function(c){var e=IX.inherit(c,{htmlFn:function(a){return a.name},click:b}),f=new TCM.Lib.Tree(e);$X("body").innerHTML=p.renderData("",{treeName:"线路设备列表",treeData:f.getHTML(),clz:"fault"}),g();var h,i,j;if(a.fromDevice){var k;IX.loop(a.items,[],function(a,b){k=b.deviceId,i=b.siteId}),j=jQuery(".nv-tree>ul>li>a[data-siteid='"+i+"']").attr("data-key"),h=IX.map(j.split(","),function(a){return Number(a)}),d(o,{types:h,siteId:i,name:"",el:"",level:"all",isHandled:!1,fromDevice:!0,deviceId:k}),jQuery(".nv-tree>ul>li>a[data-siteid='"+i+"']").addClass("select")}else if(a.fromItem){var l,m,n;IX.loop(a.items,[],function(a,b){l=b.id,i=b.siteId,m=b.level,n=b.faultDate}),j=jQuery(".nv-tree>ul>li>a[data-siteid='"+i+"']").attr("data-key"),h=IX.map(j.split(","),function(a){return Number(a)}),d(o,{types:h,siteId:i,name:"",el:"",level:m,isHandled:!1,from:TNM.Lib.GetCurDay().from,to:TNM.Lib.GetCurDay().to,fromItem:!0,id:l,faultDate:n}),jQuery(".nv-tree>ul>li>a[data-siteid='"+i+"']").addClass("select")}else"fault-site"==a._name?(j=jQuery(".nv-tree>ul>li>a[data-siteid='"+a.id+"']").attr("data-key"),h=IX.map(j.split(","),function(a){return Number(a)}),jQuery(".nv-tree>ul>li>a[data-siteid='"+a.id+"']").addClass("select"),d(o,{types:h,siteId:a.id-0,name:"",el:"",level:"all",isHandled:!1,from:null,to:null,fromSite:!0})):jQuery(".nv-tree>ul>li:first a:first span:last").click()}),c()}var i=TNM.Global.deviceCaller,j=IXW.Actions.configActions,k=TCM.Const.DeviceTypeNames,l=null,m=[{name:"",nodes:[{name:"服务器",nodes:a([1,2,3])},a([10])[0],{name:"数字摄像机",nodes:a([20,21,22])},{name:"模拟摄像机",nodes:a([31,32,33])},{name:"拾音器",nodes:a([40,41])},a([50])[0],a([53])[0],a([54])[0],a([55])[0],{name:"网络和附属设备",nodes:a([60,61,62,63,64,90])}]}],n={name:"",nodes:[{name:"服务器",nodes:a([0,1,2,3])},a([10])[0],a([53])[0],a([54])[0],a([55])[0],{name:"网络和附属设备",nodes:a([60,61,62,63,64,90])}]},o={columns:"fauSiteId,fauDeviceName,fauFaultDate,fauLevel,fauDeviceIp,fauIsHandled,fauCode,details,fauDesc"},p=(new IX.ITemplate({tpl:['<div><input class="search" placeholder="设备选择"><a class="pic-search"></a></div>',""]}),new IX.ITemplate({tpl:['<div id="Tree"><div id="treeName">{treeName}</div>{treeData}</div>','<div id="Grid" class="{clz}  nv-box"></div>',""]}));j([["ixw.grid.cell",function(a,b){var c=a.key,d=jQuery(b.parentNode.parentNode),e=jQuery(b).find("span");if("details"==c){d.siblings().removeClass("expand"),d.toggleClass("expand");var f=jQuery(b.parentNode.nextElementSibling).find("div").length;f>0&&(jQuery(".body ul").css("height","35px"),jQuery(".body .expand").css("height",35*(f+1)+"px"),jQuery(".body .expand .col-desc").css("height",35*f+1+"px"))}if("isHandled"==c&&$XH.hasClass(e.get(0),"notHandle")){var g=$XD.dataAttr(d.get(0),"id"),h=jQuery(".nv-tree").find("a.select").attr("data-siteid");i("handleFault",{id:g,siteId:h},function(a){e.removeClass("notHandle").addClass("handle"),e[0].innerHTML="已处理";var b="fault/item/"+g,c=jQuery("a[data-href='"+b+"']").parent().children().length;c>2?jQuery("a[data-href='"+b+"']").remove():jQuery("a[data-href='"+b+"']").parent().remove()})}}]]),IX.ns("TNM.Fault"),TNM.Fault.init=function(a,b,c){switch(l=TNM.Env.getSession().getLineInfo(),a.name){case"fault":if(b.flag)return;h(b,c);break;case"fault-site":h(b,c);break;case"fault-item":i("getFaultById",IX.inherit(b,{id:b.id-0}),function(a){a.fromItem=!0,h(a,c)});break;case"fault-device":b.deviceId=b.id-0,b.pageNo=0,b.pageSize=20,i("getFault4Device",IX.inherit(b,{id:b.id-0}),function(a){a.fromDevice=!0,h(a,c)})}}}(),function(){function a(){var a=null,b="logUserName,logDeviceName,siteName,logOpDate,logIp,logOpType,details,logDesc".split(","),c=!0;return s=new TNM.Lib.BaseFilterTools({hasDate:!0,defaultDate:"default",dataText:"起止时间",toolList:[{id:"siteId",text:"车站",items:{id:"siteId",items:[{id:"all",name:"所有车站",action:"site.change"}].concat(IX.loop(t,[],function(a,b,c){return a.push({id:b.id,name:b.name,action:"site.change"}),a}))}},{id:"userId",text:"用户"},{id:"deviceType",text:"设备类型"},{id:"ip",text:"IP"}]}),a=new TNM.Lib.FilterGrid({container:"Grid",title:"操作日志",clz:"logs-list",columns:b,actions:[],tools:s,usePagination:!0,baseParams:{siteId:"all",deviceType:"all",userId:"all",from:TNM.Lib.GetCurDay().from,to:TNM.Lib.GetCurDay().to,
ip:""},dataLoader:function(a,b){var d=a.siteId;"all"===d&&(a.userId="all"),n("getLogs",a,function(a){if(b(a),c){var d=$X("ip");IX.bind(d,{blur:function(a){s.change()},keydown:function(a){13==a.which&&d.blur()}}),c=!1}var e=jQuery(".sidebar").height();e>880&&jQuery(".nvgrid-body").css("min-height",e-145+"px")})}})}function b(b){$X("body").innerHTML=q.renderData("",{clz:"logs"}),a(),b()}function c(a){o("getDevicesForMonitor",{types:[0,1,2,3]},function(b){var c=IX.loop(b,[],function(a,b){var c=TCM.LineInfo.getSites().get(b.siteId),d={},e=[];return d.nodes=IX.loop(b.devices,[],function(a,b){for(var c=0;c<b.items.length;c++)e.push(b.items[c].id),a.push({key:[b.items[c].id],name:b.items[c].name,id:b.items[c].id,nodes:[]});return a}),d.key=e,d.name=c.name,d.siteId=b.siteId,1==c.type?a.unshift(d):a.push(d),a});a({nodes:c})})}function d(a){var b=IX.map(a.keys.split(","),function(a){return Number(a)});a.keys.split(",").length>1?(jQuery(".site-name").html(a.name),jQuery(".server-name").html(jQuery(a.el.parentNode).find("ul>li>a:first").attr("data-name"))):(jQuery(".site-name").html(jQuery($XH.ancestor(a.el,"fold")).find("a:first").attr("data-name")),jQuery(".server-name").html(a.name)),x=new TNM.Lib.DashboardPanel($X("container"),function(a,c){n("getPerf",{id:b[0]},a,c),f()}),y&&y.stop(),y=new TNM.Util.PeriodicChecker(function(){return $XH.first($X("container"),"mem")},x.refresh,15e3),setTimeout(function(){y.start()},15e3),x.init()}function e(){jQuery(".nv-tree>ul>li>ul>li").children("ul").hide(),jQuery(".nv-tree>ul>li").children("ul").hide(),jQuery(".nv-tree>ul>li>a span.count").hide()}function f(){function a(a,b,c){var d=1831-a;return Math.floor((b-c)/482*d+c)+"px"}var b=document.documentElement.clientWidth,c=jQuery(".sidebar").height();c>658&&($X("Tree")&&($X("Tree").style.height=c+"px"),jQuery(".monitor").css("height",c+"px"),jQuery(".nv-tree").css("height",c-60+"px"),jQuery("#container").css("height",c-40+"px")),1920>=b&&b>=1300&&(jQuery(".mem").css({top:a(b,300,200),left:a(b,30,50)}),jQuery(".cpu").css({top:a(b,30,100),left:a(b,245,475)}),jQuery(".disk").css({top:a(b,300,200),left:a(b,540,980)}))}function g(a){c(function(a){var b=IX.inherit(a,{htmlFn:function(a){return a.name},click:d}),c=new TCM.Lib.Tree(b);$X("body").innerHTML=u.renderData("",{treeName:"线路设备列表",treeData:c.getHTML(),clz:"monitor",siteName:"",serverName:""}),e(),jQuery(".nv-tree li:first a:first span:last").click(),$Xw.bind({resize:f})}),a()}function h(){var a=null,b="siteName,troDeviceName,troNum,details,troDesc".split(",");return s=new TNM.Lib.BaseFilterTools({buttons:[{value:"export"},{value:"print"}],hasDate:!0,defaultDate:"default",dataText:"起止时间",toolList:[{id:"siteId",text:"选择车站",items:{id:"siteId",items:[{id:"all",name:"所有车站"}].concat(IX.loop(t,[],function(a,b,c){return a.push({id:b.id,name:b.name}),a}))}},{id:"deviceType",text:"设备类型"}]}),a=new TNM.Lib.FilterGrid({container:"Grid",title:"统计分析",clz:"statistics-list",columns:b,actions:[],tools:s,usePagination:!0,baseParams:{siteId:"all",deviceType:"all",from:TNM.Lib.GetCurDay().from,to:TNM.Lib.GetCurDay().to},dataLoader:function(a,b){n("getStatistics",a,function(a){b(a);var c=["$grid.export","$grid.print"];0===a.items.length?jQuery(".filterBtn").removeAttr("data-href"):jQuery(".filterBtn").each(function(a,b){jQuery(this).attr("data-href",c[a])});var d=jQuery(".sidebar").height();d>880&&jQuery(".nvgrid-body").css("min-height",d-145+"px")})}})}function i(a){$X("body").innerHTML=w.renderData("",{clz:"statistics"}),h(),a()}function j(a){function b(a,b){var c=jQuery(".row[data-id="+b.id+"]").find(".col-version>a");c.attr("title",a.version||a.err).html(a.version||a.err)}var c=new NV.Lib.Grid({container:"container",clz:"monitor-base",title:"基础信息",usePagination:!0,columns:["baseName","baseType","baseIP","baseVersion"],actions:[],tools:{},dataLoader:function(c,d){n("getBaseInfo",IX.inherit(c,{id:a.keys}),function(c){d(c),jQuery("#Tree").css("height",jQuery(".nv-grid").height()),IX.iterate(c.items,function(c,d){n("getVersion",{siteId:a.keys,id:c.id,type:c.type},function(a){b(a,c)},function(a){b(a,c)})})})}});c.show()}function k(a){var b=IX.inherit({htmlFn:function(a){return a.name},click:j},{nodes:IX.map(t,function(a,b){return{name:a.name,key:[a.id],siteId:a.id,nodes:[]}})}),c=new TCM.Lib.Tree(b);$X("body").innerHTML=v.renderData("",{treeName:"线路列表",treeData:c.getHTML(),clz:"monitor"}),jQuery(".nv-tree li:first a:first span:last").click(),a()}function l(a,b){var c=a.name;"monitor-perf"==c&&(x=null)}var m=IXW.Actions.configActions,n=TNM.Global.monitorCaller,o=TNM.Global.deviceCaller,p=null,q=new IX.ITemplate({tpl:['<div id="Grid" class="{clz}"></div>',""]}),r=new IX.ITemplate({tpl:["<li>",'<a data-href="$combo.change" data-key="{id}">{name}</a>',"</li>",""]}),s=null,t=null;m([["site.change",function(a,b){var c=a.key,d=b.innerHTML,e=$XH.ancestor(b,"dropdown");if(e){var f=$XD.first(e,"input");f.value=c;var g=$XH.first($XH.first(e,"dropdown-toggle"),"name");g.innerHTML=d,jQuery(g).attr("title",d),"all"!=c?(n("getUsers",{siteId:c},function(a){var b=[{id:"all",name:"所有用户"}].concat(a);jQuery(".userId .dropdown-menu").html("").append(jQuery(IX.map(b,function(a){return r.renderData("",a)}).join("")))}),jQuery(".userId").removeClass("disable"),jQuery("#userId").attr("value","all"),jQuery("#userId").next().find("span.name")[0].innerHTML="所有用户"):(jQuery("#userId").value="all",jQuery("#userId").next().find("span.name")[0].innerHTML="所有用户",jQuery(".userId").addClass("disable")),s.change()}}],["grid.export",function(a,b){var c=jQuery('<form id="form" action="/statistics/download" method="POST" style="display:none"></form>'),d=s.getFilterParams();c.append(jQuery('<input type="text" name="from" value="'+d.from+'">')).append(jQuery('<input type="text" name="to" value="'+d.to+'">')).append(jQuery('<input type="text" name="siteId" value="'+d.siteId+'">')).append(jQuery('<input type="text" name="deviceType" value="'+d.deviceType+'">')).append(jQuery('<input type="submit">')).appendTo(jQuery("#body")),c.submit()}],["grid.print",function(a,b){jQuery(".statistics-list.ixw-grid").jqprint({importCSS:!0})}]]);var u=new IX.ITemplate({tpl:['<div id="Tree" class="{clz}"><div id="treeName">{treeName}</div>{treeData}</div>','<div class="nv-box {clz}">','<div class="nvgrid-title nv-title">性能监控</div>','<div class="server-info">','<div class="site-name">{siteName}</div>','<div class="server-space"></div>','<div class="server-name">{serverName}</div>',"</div>",'<div id="container"></div>',"</div>",""]}),v=new IX.ITemplate({tpl:['<div id="Tree" class="{clz}"><div id="treeName">{treeName}</div>{treeData}</div>','<div id="container"></div>',""]}),w=new IX.ITemplate({tpl:['<div class="{clz}">','<div id="Grid"></div>',"</div>",""]}),x=null,y=null;IX.ns("TNM.Monitor"),TNM.Monitor.init=function(a,c,d){switch(a.switchOut=l,t=IX.loop(TCM.LineInfo.getSites().getAll(),[],function(a,b,c){return("1"==b.type||"2"==b.type||"3"==b.type)&&a.push(b),a}),a.name){case"monitor-perf":p=TNM.Env.getSession().getLineInfo(),g(d);break;case"monitor-stat":i(d);break;case"monitor-logs":b(d);break;case"monitor-base":k(d)}}}(),function(){function a(){q.stop(),q.start()}function b(a){var b=$XP(a,"name",""),c=$XP(a,"id",null),d=$XP(a,"siteId"),e=$XP(a,"lineInfo");return r.setItem("tnmSessionKey",d+"-"+c),{hasAuth:function(){return null!==c},getUserName:function(){return b},getUserId:function(){return c},getSiteId:function(){return d},getLineInfo:function(){return e},getSessionKey:function(){return d+"-"+c},checkIfModuleEnabled:function(a){return!0}}}function c(){var a=IX.isOper||IX.isChrome||IX.isSafari||IX.isFirefox,b=document.location.href.indexOf("#unSupport")>-1?!1:!(a&&IX.isBelowMSIE9),c=[{name:"IE10",href:"http://windows.microsoft.com/zh-cn/internet-explorer/ie-10-worldwide-languages",icon:"ie"},{name:"IE11",href:"http://windows.microsoft.com/zh-cn/internet-explorer/ie-11-worldwide-languages",icon:"ie"},{name:"Firefox",href:"http://firefox.com.cn/",icon:"firefox"},{name:"Safari浏览器",href:"http://www.apple.com.cn/safari/",icon:"safari"},{name:"chrome浏览器",href:"http://rj.baidu.com/soft/detail/14744.html",icon:"chrome"},{name:"360极速浏览器",href:"http://chrome.360.cn/",icon:"chrome360"}];return b||(document.body.className="minor browser_unsupport",
document.body.innerHTML=t.renderData("",{bs:c})),b}function d(a){var b=new IX.IListManager;return IX.iterate(IX.Array.sort(a,function(a,b){return b.faultDate-a.faultDate}),function(a){var c=a.faultDate,d=IX.IDate(c),e=d.toDate(),f=new Date(d.toText().split(" ")[0]).getTime(),g=b.get(f);g||(g={tick:f,day:e+"&nbsp;"+d.toWeek(),faults:[]},b.register(f,g)),g.faults.push({href:m.createPath("fault-item",{id:a.id}),clz:"level"+a.level,time:d.toTime(),site:TCM.LineInfo.getSiteName(a.siteId),deviceType:o[a.deviceType],msg:p[a.code]||p[-1]})}),IX.Array.sort(b.getAll(),function(a,b){return a.tick-b.tick})}function e(a,b,c){var d=$XD.first(a,c);d?jQuery(b).insertBefore(d):jQuery(a).append(b)}function f(a,b){var c=$X("day_"+b.tick);c?e(c,IX.map(b.faults,function(a){return u.renderData("days.faults",a)}).join(""),"a"):e(a,u.renderData("days",b),"li")}function g(){function a(a){var b=$X("rtFaults");if(b&&a&&0!==a.length){IX.iterate(d(a),function(a){f(b,a)}),a&&a.length>0&&(v=a[0].id);var c=jQuery("#rtFaults").find("a");if(c.length>500){var e=c.slice(500,c.length),g=$XA(e);g.reverse(),IX.iterate(g,function(a,b){var c=jQuery(a.parentNode);c.find("a").length<=g.length-b&&c.remove(),jQuery(a).remove()})}}}return new TNM.Util.PeriodicChecker(null,function(b){s.hasAuth()&&TNM.Global.commonCaller("rtFaults",{id:v},a,b)})}function h(a){function b(a){var b=a[0];return{name:b,text:a[1],clz:"",href:a[2]||m.createPath(b)}}function c(a,c){var d=c.length>2?c[2]:[];return{name:a,text:c[1],clz:d.length>0?"":"nosub",href:m.createPath(d.length>0?d[0][0]:a),subnav:IX.map(d,b)}}function d(a,b){var c=a.split("-"),d=b?$XH.addClass:$XH.removeClass;2==c.length&&d($X("nav-"+c[0]),"active"),d($X("nav-"+a),"active")}function e(a){var b=$X("nav-"+a);a!=h&&b&&(d(h,!1),h=a,d(a,!0))}function f(a){$XH.addClass(this,"hover")}function g(a){var b=this,c=$XH.ancestor(a.toElement,"ul");c=c?c.parentNode:null,$XH.hasClass(c,"hover")||$XH.removeClass(b,"hover")}var h=a||x;return{getRenderData:function(){return IX.loop(w,[],function(a,b){var d=b[0];return a.push(c(d,b)),a})},enableHover:function(){jQuery(".main li").hover(f,g)},focus:e}}function i(){s=new b,TCM.LineInfo.destroy(),q.stop(),IXW.Pages.load("entry"),z.stop()}function j(c){TCM.LineInfo.init(c.lineInfo),s=new b(c),v=null,z=new g,document.body.innerHTML=u.renderData("",{nav:y.getRenderData(),username:c.name}),y.enableHover(),z.start(),a()}function k(a){TNM.Global.commonCaller("session",{},function(b){return b&&b.id?(j(b),v=null,void a()):m.load("entry")})}function l(){setInterval(function(){var a=r.getItem("tnmSessionKey");if(a!=s.getSessionKey())return"undefined-null"==a?NV.Dialog.confirm4login("提示","当前用户已在其他窗口退出，请重新登录！",{left:[],right:[{name:"ok",text:"确定"}]},function(){k(function(){m.reload()})}):void NV.Dialog.confirm4login("提示","已存在登录用户，请刷新页面！",{left:[],right:[{name:"ok",text:"确定"}]},function(){k(function(){m.reload()})})},3e3)}var m=(IX.Array.isFound,IXW.Pages),n=IXW.Actions,o=TCM.Const.DeviceTypeNames,p=TNM.Const.FaultFormats,q=new TNM.Util.KickChecker("",function(a,b){TNM.Global.commonCaller("isKicked","",function(c){return c&&1===c.status?NV.Dialog.confirm4login("提示","有新管理员登录系统，请您退出！",{left:[],right:[{name:"ok",text:"确定"}]},function(){i()}):(a=!0,void b())})},1),r=function(){var a=window.localStorage;return{getItem:function(b){return a.getItem(b)||null},setItem:function(b,c){a.setItem(b,c)},clear:function(){a.clear()}}}(),s=new b,t=new IX.ITemplate({tpl:['<div class="bu">','<div class="hdrp"><i class="pic logo"></i></div>','<div class="content">','<div class="t">',"<p>当前使用的浏览器版本过低，无法正常使用infobox服务，推荐您下载安装以下浏览器中的任一款，然后再用新浏览器访问（www.CCTVxxx.com），给您带来不便，非常抱歉。</p>","</div>",'<div class="label">',"<ul>","<tpl id='bs'>","<li>","<a class ='i {icon}'></a>","<span>{name}</span>",'<a class = \'href\' target="_blank" href="{href}">{href}</a>',"</li>","</tpl>","</ul>","</div>","</div>","</div>",""]}),u=new IX.ITemplate({tpl:['<nav class="navbar navbar-inverse navbar-fixed-top">','<div class="container-fluid">','<div class="navbar-header">','<a href="#"><span class="badges"></span>','<span class="navbar-brand">CCTV网管系统</span></a>',"</div>",'<ul class="nav navbar-nav main">','<tpl id="nav">','<li id="nav-{name}" class="{clz}">','<a data-href="{href}">','<span class="nav-{name}"></span><span>{text}</span>',"</a>",'<ul class="sub">','<tpl id="subnav">','<li id="nav-{name}" class="{clz}">','<a data-href="{href}">{text}</a>',"</li>","</tpl>","</ul>","</li>","</tpl>","</ul>",'<ul class="nav navbar-nav navbar-right">','<li class="profile"><span class="pic-avatar"></span>','<span class="name">{username}</span></li>','<li class="logout"><a data-href="$logout"><span class="sp"></span>',"<span>退出</span></a></li>","</ul>","</div>","</nav>",'<div class="bg"><div class="fix-bottom"></div></div>','<div id="topbar" class="hide"></div>','<div id="body"></div>','<div class="sidebar nv-box">','<div class="nv-title">实时告警</div>','<div class="nv-body"><ul id="rtFaults">','<tpl id="days">','<li id="day_{tick}">','<div class="title">{day}</div>','<tpl id="faults">','<a data-href="{href}" class="{clz}">','<span class="color"></span><span class="text">{time}&nbsp;{site}的{deviceType}{msg}</span><span class="border-bottom"></span>',"</a>","</tpl>","</li>","</tpl>","</ul></div>","</div>",""]}),v=null,w=[["sys","线路管理",[["sys-line","线路信息"],["sys-rack","机柜管理"],["sys-topo","拓扑管理"]]],["device","设备管理"],["fault","故障管理"],["monitor","监控信息",[["monitor-perf","性能监控"],["monitor-stat","统计分析"],["monitor-logs","操作日志"],["monitor-base","基础信息"]]]],x="sys-line",y=new h,z=new g,A=IX.map([{type:"ErrPage",name:"401",needAuth:!1},{type:"ErrPage",name:"404",needAuth:!1},{name:"sys-line",isDefault:!0,bodyClz:"sys-line"},{name:"sys-rack",path:"sys/rack/{id}",bodyClz:"sys-rack"},{name:"sys-topo",bodyClz:"sys-topo"},{name:"device"},{name:"device-issue",path:"device/{id}",navItem:"device"},{name:"device-site",path:"device/site/{id}",navItem:"device"},{name:"fault"},{name:"fault-device",path:"fault/device/{id}/{siteId}",navItem:"fault"},{name:"fault-site",path:"fault/site/{id}",navItem:"fault"},{name:"fault-item",path:"fault/item/{id}",navItem:"fault"},{name:"fault-match",path:"fault/match",navItem:"fault"},{name:"monitor-perf"},{name:"monitor-stat"},{name:"monitor-logs"},{name:"monitor-base"},{name:"entry",bodyClz:"entry",needAuth:!1}],function(a){var b=a.name,c=b.split("-"),d=c[0],e=a.type||d.capitalize();return IX.inherit({initiator:"TNM."+e+".init",path:c.join("/"),nav:"service",navItem:b,needAuth:!0},a)});n.configActions([["logout",function(){function a(){TNM.Global.entryCaller("logout",{},function(){i(),v=null})}NV.Dialog.confirm("提示","确认是否退出?",a)}]]),IX.ns("TNM.Env"),TNM.Env.init=function(){m.listenOnClick(document.body),m.configPages(A,function(a,b){return!$XP(b,"needAuth",!0)||s.hasAuth()}),IXW.Navs.register("service",function(a){y.focus(a.navItem||"")}),k(function(){m.start()}),l()},TNM.Env.reloadSession=function(){k(function(){m.reload()})},TNM.Env.clearSession=i,TNM.Env.hasSession=function(){return s.hasAuth()},TNM.Env.resetSession=function(a){j(a)},TNM.Env.getSession=function(){return s},TNM.Env.getLocalStroage=function(){return r.getItem("tnmSessionKey")},TNM.Env.clearLocalStroage=function(){return r.clear()},TNM.Env.clearRTFaultWorker=function(){z.stop()},TNM.Env.isKicked=function(){q.stop()};var B=!1;TNM.init=function(){B||(B=!0,c(),TNM.Env.init())}}();